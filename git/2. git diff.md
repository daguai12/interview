好的，当然可以。`git diff` 是每个开发者日常工作中最重要的命令之一，它就像医生的听诊器，能帮你精确地诊断代码库中发生的“变化”。

我们将继续以新加坡开发者 Alex 的故事为例。今天是 2025 年 9 月 26 日，星期五的早晨，Alex 需要在他昨天完成的促销横幅功能上，增加一个新的倒计时功能。

-----

### 场景搭建：继续功能开发

Alex 从昨天清理干净的 `feature/add-promo-banner` 分支开始工作。

**当前状态**:

  * `git status` 显示工作区是干净的。
  * `git log --oneline` 显示了清晰的提交历史。

<!-- end list -->

```
a2b3c4d (HEAD -> feature/add-promo-banner) feat: Add and style promo banner
...
```

> 这个场景是我们进行比较的**基线 (Baseline)**。

-----

### 开发流程与 `git diff` 的五种核心用法

#### 用法一: `git diff` —— 查看“还没暂存”的修改

Alex 的第一个任务是添加倒计时功能的 HTML 结构和一个新的 JS 文件。

**1. 修改代码**

  * 他修改了 `index.html`，加入了倒计时的 `<span>` 元素。
  * 他创建了一个新文件 `promo.js`，并写了一些占位逻辑。

**2. 使用 `git diff` 进行审查**
在执行 `git add` 之前，Alex 想看看他到底改了些什么。

```bash
git diff
```

**`git diff` 的作用**:
这个最基础的命令，比较的是你的\*\*工作目录（你当前能看到的文件）**和**暂存区（你上次 `git add` 的版本）\*\*之间的差异。

**输出解读**:

```diff
diff --git a/index.html b/index.html
index a1b2c3d..e4f5g6h 100644
--- a/index.html
+++ b/index.html
@@ -1,3 +1,5 @@
 <body>
-  +  <div class="banner">
+    <p>Sale ends in: <span id="countdown"></span></p>
+  </div>
 </body>
diff --git a/promo.js b/promo.js
new file mode 100644
index 0000000..ab12cd3
--- /dev/null
+++ b/promo.js
@@ -0,0 +1,3 @@
+function startCountdown() {
+  console.log('Countdown started!');
+}
```

  * **`--- a/index.html`** 和 **`+++ b/index.html`** 表示比较的两个文件版本。
  * **`@@ ... @@`** (Hunk Header) 告诉你变动发生在文件的哪几行。
  * **`-`** 开头的行表示被**删除**或修改前的旧内容。
  * **`+`** 开头的行表示被**添加**或修改后的新内容。
  * 对于新文件 `promo.js`，它显示文件是从 `/dev/null` (空) 创建的。

**3. 暂存部分文件**
Alex 对 `index.html` 的修改很满意，于是先把它加入暂存区。

```bash
git add index.html
```

现在，如果他再次运行 `git diff`...

```bash
git diff
```

...他会发现 `index.html` 的差异**不见了**！现在 `git diff` 只会显示 `promo.js` 的差异（因为它还是一个未追踪的新文件）。这是因为 `index.html` 在工作目录和暂存区的版本已经一致了。

#### 用法二: `git diff --staged` —— 检查“即将提交”的内容

Alex 准备提交了，但他想最后确认一下这次提交会包含哪些内容。

```bash
git diff --staged
# --cached 是 --staged 的同义词，效果一样
```

**`git diff --staged` 的作用**:
这个命令比较的是**暂存区**和**最后一次提交 (`HEAD`)** 之间的差异。它能精确地告诉你，如果现在执行 `git commit`，会发生什么变化。这是提交前的“彩排”。

**输出**:
此时的输出会**只包含 `index.html` 的改动**，因为 `promo.js` 还没有被 `git add`，所以它不在暂存区里。

#### 用法三: `git diff HEAD` —— 查看“所有未提交”的修改

有时候，Alex 不想区分暂存区和工作目录，只想知道相比上次提交，他总共做了哪些修改。

```bash
git diff HEAD
```

**`git diff HEAD` 的作用**:
这个命令比较的是**工作目录**和**最后一次提交 (`HEAD`)**，它会**忽略**暂存区。

**输出**:
此时，输出会同时包含 `index.html` 和 `promo.js` 的所有改动。

#### 用法四: `git diff <commit1> <commit2>` —— 比较“任意两次提交”

Alex 完成了 `promo.js` 的逻辑，并把所有文件都提交了。

```bash
git add promo.js
git commit -m "feat: Add countdown timer to banner"
```

现在，项目经理想看看这个新功能分支 (`feature/add-promo-banner`) 相比主分支 (`main`) 到底多了哪些改动。

```bash
git diff main feature/add-promo-banner
```

**`git diff <A> <B>` 的作用**:
它可以比较任意两个提交、两个分支、一个提交和一个分支等。它会显示从 A 到 B 的**累积差异**。这在代码审查（Code Review）或合并分支前非常有用。

**输出**:
会显示出从 `main` 分支的最新状态到 `feature/add-promo-banner` 分支最新状态的所有代码变动，包括横幅的 HTML, CSS 和倒计时的 JS。

#### 用法五: `git diff --stat` —— 查看“简明统计”

如果两次提交之间的差异非常大，逐行阅读很费时。Alex只想快速了解一下改动概况。

```bash
git diff --stat main feature/add-promo-banner
```

**`git diff --stat` 的作用**:
它不显示具体的代码行差异，而是提供一个**统计摘要**。

**输出**:

```
 index.html | 5 +++++
 promo.js   | 3 +++
 style.css  | 2 ++
 3 files changed, 10 insertions(+)
```

这个输出一目了然：总共修改了3个文件，`index.html` 添加了5行，`promo.js` 添加了3行，`style.css` 添加了2行。

-----

### 总结

`git diff` 是一个多面手，它的行为取决于你给它的参数。

| 命令 | 比较范围 | 常见用途 |
| :--- | :--- | :--- |
| `git diff` | **工作目录** vs **暂存区** | 查看还未 `git add` 的修改。 |
| `git diff --staged` | **暂存区** vs **`HEAD`** (最后一次提交) | 审查即将要 `git commit` 的内容。 |
| `git diff HEAD` | **工作目录** vs **`HEAD`** | 查看所有未提交的修改（无论是否已暂存）。 |
| `git diff <A> <B>`| 任意两个**提交/分支**之间的差异 | 代码审查、合并前检查、版本对比。 |
| `git diff --stat` | (同上，但只显示统计信息) | 快速概览变更的文件和行数。 |

养成在 `git add` 和 `git commit` 前使用 `git diff` 和 `git diff --staged` 的习惯，是保证代码提交质量和避免错误的关键一步。
`git diff` 是 Git 中一个极其强大且常用的命令，它的核心作用就是 **“找不同”**。通过它，你可以清晰地看到文件的改动、暂存区的变化、提交与提交之间的差异、分支与分支之间的区别等等。

-----

### 案例背景：开发一个简单的个人主页网站

假设你正在为自己创建一个简单的个人主页。我们从项目初始化开始，一步步进行修改，并在每个关键节点使用 `git diff` 来查看变化。

#### 第1步：项目初始化和首次提交

首先，我们创建项目目录，初始化 Git 仓库，并创建第一个文件 `index.html`。

```bash
# 1. 创建并进入项目目录
mkdir my-homepage
cd my-homepage

# 2. 初始化 Git 仓库
git init

# 3. 创建一个简单的 HTML 文件
echo "<h1>我的个人主页</h1>" > index.html

# 4. 将文件添加到暂存区并提交
git add index.html
git commit -m "Initial commit: Add homepage title"
```

现在，我们的项目有了一个干净的起点。

-----

### 场景一：工作区 vs 暂存区 (最常用)

你打算给主页增加一段自我介绍。于是你修改了 `index.html` 文件。

**操作：** 编辑 `index.html`，内容如下：

```html
<h1>我的个人主页</h1>
<p>你好，我是一名软件开发者。</p>
```

现在，你的**工作区 (Working Directory)** 文件已经被修改了，但是这些修改还没有被 `git add` 到**暂存区 (Staging Area)**。

**如何查看你刚刚做了哪些修改？**

这时候，直接运行 `git diff`：

```bash
git diff
```

你会看到如下输出：

```diff
diff --git a/index.html b/index.html
index 7d8963c..f08a6a5 100644
--- a/index.html
+++ b/index.html
@@ -1,1 +1,2 @@
 <h1>我的个人主页</h1>
+<p>你好，我是一名软件开发者。</p>
```

**输出解读：**

  * `--- a/index.html`：代表修改前的版本（`a` 通常指代 old/source）。
  * `+++ b/index.html`：代表修改后的版本（`b` 通常指代 new/destination）。
  * `@@ -1,1 +1,2 @@`：这叫做 "hunk"，它指明了变动发生的范围。`-1,1` 表示旧文件从第1行开始的1行内容，`+1,2` 表示新文件从第1行开始的2行内容。
  * `  <h1>我的个人主页</h1> `：前面是空格，表示这一行没有变化。
  * `+<p>你好，我是一名软件开发者。</p>`：前面是 `+` 号，表示这是**新增**的一行。

> **💡 核心总结 1：**
> 直接运行 `git diff`，比较的是 **当前工作区** 和 **暂存区** 之间的差异。它能告诉你，相对于上次 `git add` 的内容，你又新做了哪些改动。

-----

### 场景二：暂存区 vs 最新提交

你对刚才的修改很满意，决定将它提交。所以你先用 `git add` 将改动放入暂存区。

**操作：**

```bash
git add index.html
```

现在，我们再来运行一下刚刚的命令：

```bash
git diff
```

你会发现，**没有任何输出！** 这是为什么？因为 `git diff` 默认比较的是工作区和暂存区，而你刚刚通过 `git add` 已经让它们俩的内容保持一致了。

**那么，如何查看已暂存但尚未提交的改动呢？**

你需要添加 `--staged` (或者 `--cached`) 参数：

```bash
git diff --staged
```

输出结果和场景一完全一样：

```diff
diff --git a/index.html b/index.html
index 7d8963c..f08a6a5 100644
--- a/index.html
+++ b/index.html
@@ -1,1 +1,2 @@
 <h1>我的个人主页</h1>
+<p>你好，我是一名软件开发者。</p>
```

> **💡 核心总结 2：**
> `git diff --staged` 比较的是 **暂存区** 和 **上一次提交 (HEAD)** 之间的差异。它能让你在 `git commit` 之前，最后一次检查将要提交的内容是否准确。

我们现在提交这次修改。

```bash
git commit -m "Feat: Add self-introduction"
```

-----

### 场景三：比较两次提交之间的差异

几天后，你觉得自我介绍太简单了，想加上你的技能。

**操作：** 你再次修改 `index.html`。

```html
<h1>我的个人主页</h1>
<p>你好，我是一名软件开发者。我擅长使用 Git 和 Python。</p>
```

然后提交这次修改。

```bash
git add index.html
git commit -m "Docs: Update introduction with skills"
```

现在，你的提交历史看起来是这样的 (可以用 `git log --oneline` 查看)：

```
f3a7a28 (HEAD -> master) Docs: Update introduction with skills
c8a3b1e Feat: Add self-introduction
b2d7a23 Initial commit: Add homepage title
```

**如何比较最新一次提交和上一次提交的差异？**

你可以使用 `HEAD` (指向当前提交) 和 `HEAD~1` (指向上一次提交)。

```bash
git diff HEAD~1 HEAD
```

你会看到如下输出：

```diff
diff --git a/index.html b/index.html
index f08a6a5..4a515e5 100644
--- a/index.html
+++ b/index.html
@@ -1,2 +1,2 @@
 <h1>我的个人主页</h1>
-<p>你好，我是一名软件开发者。</p>
+<p>你好，我是一名软件开发者。我擅长使用 Git 和 Python。</p>
```

**输出解读：**

  * `-<p>你好，我是一名软件开发者。</p>`：`-` 号表示这一行在旧版本中存在，但在新版本中被**删除**了。
  * `+<p>你好，我是一名软件开发者。我擅长使用 Git 和 Python。</p>`：`+` 号表示这一行是新版本中**新增**的。

实际上，Git 将 "修改一行" 视为 "删除旧行，增加新行" 的组合。

**如何比较任意两次提交？**

只需提供两次提交的 commit hash 即可。

```bash
# 比较第一次和第三次提交的差异
git diff b2d7a23 f3a7a28
```

> **💡 核心总结 3：**
> `git diff <commit1> <commit2>` 比较的是 **两次指定提交** 之间的差异。这对于代码审查、追溯 bug 的引入非常有帮助。

-----

### 场景四：比较两个分支之间的差异

你的主页越来越受欢迎，你决定新增一个“项目经历”页面。这是一个比较大的功能，所以你决定新建一个分支 `feature/projects` 来开发，以免影响主分支 `master`。

**操作：**

```bash
# 1. 创建并切换到新分支
git checkout -b feature/projects

# 2. 创建一个新文件 projects.html
echo "<h2>我的项目</h2><ul><li>项目一</li></ul>" > projects.html

# 3. 提交新文件
git add projects.html
git commit -m "Feat: Add projects page"

# 4. 为了让差异更明显，我们再修改一下主页
echo "<h1>我的个人主页（开发中）</h1>" > index.html
git add index.html
git commit -m "Style: Update title for dev branch"
```

现在，`feature/projects` 分支比 `master` 分支领先了两次提交。

**如何查看 `feature/projects` 分支相对于 `master` 分支到底改了什么？**

首先，切回 `master` 分支，然后执行比较命令。

```bash
git checkout master
git diff feature/projects
```

或者使用更清晰的语法 `git diff <source_branch>..<target_branch>`：

```bash
git diff master..feature/projects
```

你会看到两次提交的所有累积差异：

```diff
diff --git a/index.html b/index.html
index 7d8963c..06b98ca 100644
--- a/index.html
+++ b/index.html
@@ -1 +1 @@
-<h1>我的个人主页</h1>
+<h1>我的个人主页（开发中）</h1>
diff --git a/projects.html b/projects.html
new file mode 100644
index 0000000..8b3359d
--- /dev/null
+++ b/projects.html
@@ -0,0 +1 @@
+<h2>我的项目</h2><ul><li>项目一</li></ul>
```

这个输出告诉我们：

1.  `index.html` 的标题被修改了。
2.  新增了一个 `projects.html` 文件。

> **💡 核心总结 4：**
> `git diff <branch1>..<branch2>` 比较的是 **两个分支的顶端（最新提交）** 之间的差异。这是在合并分支（Merge Request / Pull Request）前，检查代码改动的核心操作。

### 常用 `git diff` 命令总结

| 命令 | 作用 |
| :--- | :--- |
| `git diff` | 比较 **工作区** 和 **暂存区** 的差异。 |
| `git diff --staged` | 比较 **暂存区** 和 **最新提交 (HEAD)** 的差异。 |
| `git diff HEAD` | 和 `git diff` 效果一样，也是比较工作区和 HEAD 的差异，但包含了暂存区。 |
| `git diff <commit>` | 比较 **工作区** 和 **指定提交** 的差异。 |
| `git diff <commit1> <commit2>` | 比较 **两次指定提交** 之间的差异。 |
| `git diff <branch1>..<branch2>`| 比较 **两个分支** 之间的差异。 |
| `git diff <file_path>` | 只查看 **特定文件** 的差异（可与以上命令组合使用）。 |
| `git diff --stat` | 不显示具体代码差异，只显示**改动统计信息**（哪些文件被改了，改了多少行）。 |

希望这个详细的案例能帮助你彻底掌握 `git diff` 的使用！在日常开发中，请养成 `git commit` 前必用 `git diff` 和 `git diff --staged` 检查的好习惯。
好的，我们用一个从零开始的简单案例，来详细讲解 CMake 中最核心、最基础的命令之一：`add_executable`。

### `add_executable` 的核心思想

`add_executable` 的作用就像一个食谱里的核心指令。它告诉 CMake：

**“请用我给你的这些 `.cpp` 源文件（食材），通过编译和链接（烹饪方法），最终制作出一个可以运行的程序（一道菜）。”**

它至少需要两个信息：

1.  你希望最终生成的可执行程序叫什么名字？（比如 `my_app` 或 `game`）
2.  制作这个程序需要哪些源文件？（比如 `main.cpp`, `player.cpp` 等）

-----

### 案例一：最简单的 "Hello, World\!" (单个源文件)

这是使用 `add_executable` 的最基本形式。我们的项目只有一个源文件。

#### 第1步：创建项目文件

在一个空文件夹中，创建以下两个文件：

**1. `main.cpp`**

```cpp
// main.cpp
#include <iostream>

int main() {
    std::cout << "Hello from my first CMake executable!" << std::endl;
    return 0;
}
```

**2. `CMakeLists.txt`**

```cmake
# 1. CMake 最低版本要求 (标准开头)
cmake_minimum_required(VERSION 3.10)

# 2. 项目名称 (标准开头)
project(HelloWorldApp)

# 3. 使用 add_executable 创建可执行文件 (本案例的核心！)
#    - 第一个参数 my_app 是你给程序起的名字
#    - 第二个参数 main.cpp 是制作这个程序所需要的源文件
add_executable(my_app main.cpp)
```

#### 第2步：分析 `add_executable`

`add_executable(my_app main.cpp)` 这行代码非常直白：

  * **`add_executable`**: 这是要执行的命令。
  * **`my_app`**: 这是我们定义的\*\*目标（Target）\*\*名称。CMake 将生成一个名为 `my_app` (在 Windows 上是 `my_app.exe`) 的可执行文件。
  * **`main.cpp`**: 这是构建 `my_app` 所需的源文件列表。目前只有一个。

#### 第3步：构建并运行

打开终端，进入项目文件夹。

```bash
# 1. 创建并进入构建目录
mkdir build
cd build

# 2. 运行 CMake 来配置项目并生成构建系统 (例如 Makefile)
cmake ..

# 3. 运行构建工具来编译项目
cmake --build .
```

编译成功后，`build` 目录下就会出现一个名为 `my_app` 的可执行文件。

```bash
# 4. 运行你的程序
./my_app
```

**输出结果：**

```
Hello from my first CMake executable!
```

-----

### 案例二：一个简单的计算器 (多个源文件)

现实中的项目通常不止一个 `.cpp` 文件。`add_executable` 可以轻松处理这种情况。

#### 第1步：创建项目文件

这次，我们的项目结构如下，把数学运算相关的函数分离到单独的文件中：

```
.
├── CMakeLists.txt
├── main.cpp
├── math_utils.cpp
└── math_utils.h
```

**1. `math_utils.h` (头文件，声明函数)**

```cpp
// math_utils.h
#pragma once // 防止头文件被重复包含

int add(int a, int b);
```

**2. `math_utils.cpp` (源文件，定义函数)**

```cpp
// math_utils.cpp
#include "math_utils.h"

int add(int a, int b) {
    return a + b;
}
```

**3. `main.cpp` (主程序，使用函数)**

```cpp
// main.cpp
#include <iostream>
#include "math_utils.h" // 包含我们自己的头文件

int main() {
    int x = 10;
    int y = 5;
    int sum = add(x, y);

    std::cout << x << " + " << y << " = " << sum << std::endl;
    return 0;
}
```

**4. `CMakeLists.txt` (更新后的构建脚本)**
唯一的改动就是在 `add_executable` 中加入新的源文件。

```cmake
cmake_minimum_required(VERSION 3.10)
project(CalculatorApp)

# 将所有需要编译的 .cpp 文件都列出来
add_executable(
  my_calculator
  main.cpp
  math_utils.cpp
)
```

> **注意**：通常我们**不需要**把头文件 (`.h`) 列在 `add_executable` 中。因为 C++ 的 `#include` 机制会自动处理它们。你只需要列出需要被编译器直接编译的源文件 (`.cpp`)。

#### 第2步：构建并运行

步骤和之前完全一样。

```bash
# (如果还在之前的 build 目录, 可以先清空或直接构建)
# cd build
cmake ..
cmake --build .

# 运行新的程序
./my_calculator
```

**输出结果：**

```
10 + 5 = 15
```

CMake 成功地将 `main.cpp` 和 `math_utils.cpp` 一起编译，并链接成了一个名为 `my_calculator` 的可执行程序。

### 关键 takeaway

> `add_executable` 是你在 CMake 中定义一个应用程序的起点。它创建一个**目标 (Target)**，然后你可以用其他命令（如 `target_link_libraries`, `target_include_directories` 等）来为这个目标添加库依赖、头文件路径等更多配置。
### 详细解析与代码示例

#### 声明 (Declaration)

**目的**：向编译器**介绍**一个变量或函数的存在，说明它的名字和类型，但**不为它分配内存**。

  * **关键字**：对于变量，声明通常使用 `extern` 关键字来显式地告诉编译器：“这只是一个声明，定义在别处”。
  * **应用**：主要用于在多个源文件之间共享全局变量或函数。一个文件使用了在另一个文件中定义的变量。

**示例：**
假设我们有两个文件 `main.cpp` 和 `utils.cpp`。

```cpp
// ---- utils.h ----
// 头文件通常只放声明，不放定义
extern int shared_counter; // 声明：告诉所有包含此头文件的文件，有一个名为 shared_counter 的 int 变量存在
void increment_counter();  // 函数声明（也叫函数原型）


// ---- utils.cpp ----
#include "utils.h"

// shared_counter 的定义在这里！
int shared_counter = 0; 

void increment_counter() {
    shared_counter++;
}
```

```cpp
// ---- main.cpp ----
#include <iostream>
#include "utils.h"

// 这里包含了 utils.h，所以 main.cpp 也知道了 shared_counter 的声明
// extern int shared_counter; // 也可以直接在这里写声明

int main() {
    std::cout << "Initial value: " << shared_counter << std::endl;
    increment_counter();
    std::cout << "After increment: " << shared_counter << std::endl;
    return 0;
}
```

在这个例子中，`main.cpp` 能够成功编译，因为它通过 `utils.h` 中的 `extern` 声明知道了 `shared_counter` 的存在和类型。它相信在链接阶段，链接器（Linker）会找到这个变量的实体（定义）。

#### 定义 (Definition)

**目的**：**创建**变量或函数的实体，并为其**分配存储空间**。

  * **特点**：一个定义本身也是一个声明（因为它也说明了名字和类型）。但它额外执行了分配内存的操作。
  * **规则**：**单一个义规则 (One Definition Rule, ODR)** 是C++的一项核心规则，即一个变量或函数在整个程序中**只能被定义一次**。
      * 如果**没有定义**：链接器在链接所有文件时会报错，提示“**未定义的引用 (undefined reference)**”或“**无法解析的外部符号 (unresolved external symbol)**”。
      * 如果有**多个定义**：链接器会报错，提示“**重复定义 (multiple definition)**”或“**符号重定义 (symbol redefinition)**”。

在上面的例子中，`int shared_counter = 0;` 位于 `utils.cpp` 中，这就是 `shared_counter` 在整个程序中**唯一**的定义。

-----

### 特殊情况：局部变量

对于在函数内部定义的**局部变量**，声明和定义通常是同时发生的，我们一般不做区分。

```cpp
void my_function() {
    int local_var = 10; // 这既是声明也是定义
}
```

因为局部变量的作用域仅限于函数内部，不存在跨文件共享的需求，所以 `extern` 对它没有意义。

### 总结表格

| 特性        | 声明 (Declaration)         | 定义 (Definition)         |
| :-------- | :----------------------- | :---------------------- |
| **核心作用**  | **“介绍”** 变量，告知其存在、名字和类型。 | **“创建”** 变量，为其分配实体和内存。  |
| **内存分配**  | ❌ **不分配**                | ✅ **分配**                |
| **出现次数**  | ✅ 可以**多次** (在不同文件中)      | ❌ **只能一次** (在整个程序中)     |
| **典型关键字** | `extern` (对于变量)          | 无特殊关键字 (但初始化是定义的标志)     |
| **阶段**    | 主要服务于**编译器**，让单个文件能通过编译。 | 主要服务于**链接器**，提供符号的实际地址。 |

一句话总结：**声明是给编译器的承诺，定义是对这个承诺的兑现。**

### 25.3 变量与常量

  - **核心思想**：当你在脚本中需要多次使用同一个字符串时，应将其存入一个**变量**中。这样做可以极大地简化后续的修改和维护工作。
  - **变量的创建**：在 Shell 中，变量无需事先声明，在第一次赋值时会自动创建。
      - **优点**：方便快捷。
      - **缺点**：容易因拼写错误导致 bug。如果你不小心写错了变量名，Shell 会创建一个新的空变量，而不是报错。

**关键示例 1：拼写错误的陷阱**

```shell
[me@linuxbox ~]$ filename="report.txt"
[me@linuxbox ~]$ echo $filename
report.txt

# 不小心拼错了变量名
[me@linuxbox ~]$ echo $filenmae
                   # 输出为空，因为 $filenmae 是一个新建的空变量
```

  - **常量 (Constant)**：如果一个变量的值在脚本中不应被改变，我们称之为“常量”。
      - **命名惯例**：常量名通常使用**全大写字母**，以和普通变量（通常小写）区分。这只是一种编程风格，用以提醒程序员不要修改它。

**关键示例 2：使用常量简化脚本（纯文本报告版）**
我们将重复出现的报告标题存入一个大写的常量 `TITLE` 中。

```bash
#!/bin/bash
# 程序输出一个系统信息报告

# 使用常量存储标题，并加入了主机名
TITLE="System Information Report For $HOSTNAME"

echo "=============================================="
echo "$TITLE"
echo "=============================================="
```

#### 25.3.1 为变量与常量赋值

  - **核心语法**：`variable=value`

      - **重点**：等号 `=` 的两边**绝对不能有空格**。
      - Shell 将所有变量值都视为字符串。

  - **值的类型**：`value` 可以是任何能扩展成字符串的东西。

      - `a=z` (普通字符串)
      - `b="a string"` (带空格的字符串必须加引号)
      - `c="$(ls -l)"` (**命令替换**: 将命令的输出作为值)
      - `d=$((5 * 7))` (**算术扩展**: 将数学计算结果作为值)

  - **处理歧义 `{}`**：当变量名和紧跟其后的字符可能混淆时，用花括号 `{}` 把变量名括起来。

**关键示例 3：用 `{}` 避免变量名歧义**

```shell
[me@linuxbox ~]$ filename="report"
# 错误：Shell 试图寻找一个叫 "filename.txt" 的变量，但它不存在
[me@linuxbox ~]$ echo "$filename.txt"

# 正确：用 {} 明确界定变量名的范围
[me@linuxbox ~]$ echo "${filename}.txt"
report.txt
```

**关键示例 4：为报告增加更多信息**
我们使用命令替换来获取当前时间和用户名，并将它们存入变量。

```bash
#!/bin/bash
# 程序输出一个系统信息报告

TITLE="System Information Report For $HOSTNAME"
CURRENT_TIME="$(date +"%Y-%m-%d %T")"
TIMESTAMP="Generated $CURRENT_TIME, by $USER"

echo "=============================================="
echo "$TITLE"
echo "----------------------------------------------"
echo "$TIMESTAMP"
echo "=============================================="
```

#### 25.3.2 here document

  - **核心思想**：`here document` 是一种 I/O 重定向，它允许你在脚本中嵌入一个文本块，并将这个块作为某个命令的标准输入。
  - **核心语法**：
    ```
    command << TOKEN
    这里是多行文本...
    $VARIABLES 也会被展开
    TOKEN
    ```
      - `TOKEN` 是一个自定义的分隔符（习惯用 `_EOF_`），用于标记文本块的开始和结束。结束的 `TOKEN` 必须单独占一行，且行首行尾不能有任何空格。

**关键示例 5：用 `here document` 重写报告脚本**
使用 `cat` 和 `here document` 可以更自然地输出大段的多行文本。

```bash
#!/bin/bash
# 程序输出一个系统信息报告

TITLE="System Information Report For $HOSTNAME"
CURRENT_TIME="$(date +"%Y-%m-%d %T")"
TIMESTAMP="Generated $CURRENT_TIME, by $USER"

cat << _EOF_
===================================================
             $TITLE
---------------------------------------------------
$TIMESTAMP
===================================================
_EOF_
```

**关键示例 6：`here document` 的实际应用（FTP下载）**
`here document` 非常适合为需要连续输入的交互式命令（如 `ftp`）提供指令。

```bash
#!/bin/bash
# 通过 FTP 自动下载文件的脚本

FTP_SERVER=ftp.nl.debian.org
REMOTE_FILE=README.html

ftp -n << _EOF_
open $FTP_SERVER
user anonymous me@linuxbox
get $REMOTE_FILE
bye
_EOF_

ls -l "$REMOTE_FILE"
```

  - **缩进技巧 `<<-`**：如果你使用 `<<- TOKEN`（注意中间的连字符），那么 `here document` 正文部分**行首的 Tab 字符**会被忽略。这可以让你在写代码时为了美观而缩进文本块。
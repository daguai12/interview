### 8.1 编辑命令行

本节介绍了 Bash Shell 中由 Readline 库提供的强大命令行编辑功能。这些功能通过一系列键盘快捷键实现，可以极大地提升在终端中输入和修改命令的效率。用户可以根据自己的需要选择学习和使用。

***

#### 摘要

本节将 Readline 提供的键盘快捷键分为三类：光标移动、文本修改以及剪切粘贴。

##### 1. 光标移动

除了常规的方向键，还可以使用以下快捷键在命令行中快速移动光标：

* **Ctrl-A**: 移动到行首。
* **Ctrl-E**: 移动到行尾。
* **Alt-B**: 向后（左）移动一个单词。
* **Alt-F**: 向前（右）移动一个单词。
* **Ctrl-L**: 清除屏幕内容，效果等同于 `clear` 命令。

##### 2. 修改文本

用于快速纠正拼写错误或调整文本格式：

* **Ctrl-D**: 删除光标所在位置的字符。

##### 3. 剪切和粘贴文本

Readline 将“剪切”称为 **killing**，将“粘贴”称为 **yanking**。被剪切的文本会存放在一个名为 “kill-ring” 的缓冲区中。

* **Ctrl-K**: 剪切从光标到行尾的文本。
* **Ctrl-U**: 剪切从光标到行首的文本。
* **Ctrl-Y**: 在光标处粘贴（yanking）kill-ring 缓冲区中的内容。

##### 辅助键 (Meta Key)

文中所提到的 **Alt** 键在 Readline 文档中被称为**辅助键 (Meta Key)**。这是源于旧式终端键盘的历史术语。在现代键盘上，**Alt 键**就是辅助键。如果 Alt 键与其他程序功能冲突，可以尝试通过**先按一下 `Esc` 键再按目标键**的方式来模拟 Alt 组合键的功能。



### 8.2 补全功能

本节介绍了 Shell 提供的**补全 (Completion)** 功能，这是一种通过按 `Tab` 键来自动完成命令、路径名和其他文本，从而显著提高命令行操作效率的机制。

***

#### 摘要

##### 工作原理

补全功能的核心是 `Tab` 键。其基本工作流程如下：

1.  **唯一匹配**: 当你输入一个单词的开头部分（如 `ls Do`）并按 `Tab` 键，如果 Shell 能找到唯一的匹配项（如 `Documents`），它会自动补全该单词。

2.  **模糊匹配**: 如果输入的前缀有多个可能的匹配项（如输入 `ls D`，同时存在 `Desktop` 和 `Documents`），按一次 `Tab` 键通常不会有反应。

3.  **显示列表**: 在模糊匹配的情况下，**再按一次 `Tab` 键** (或在某些系统上使用 `Alt-$`)，Shell 会列出所有可能的补全选项，供你参考以便输入更多字符来消除歧义。

##### 补全的类型

补全功能不仅限于文件名和路径名，它还适用于多种上下文：

* **命令**: 如果光标位于行首，`Tab` 键会尝试补全命令名称。
* **路径名**: 最常见的用法，补全文件和目录名。
* **变量**: 如果单词以 `$` 开头，会尝试补全变量名。
* **用户名**: 如果单词以 `~` 开头，会尝试补全系统中的用户名。
* **主机名**: 如果单词以 `@` 开头，会尝试补全网络主机名。

##### 可编程补全

现代 Bash 还支持**可编程补全**功能。这是一种更高级的、可定制的补全机制，它允许为特定命令定义补全规则，例如自动补全命令的**选项**（如 `tar --` 后按 `Tab`）或特定应用支持的文件类型。此功能通常由 Linux 发行版预先配置好，以增强用户体验。

### 8.3 命令历史记录

本节介绍了 Bash Shell 提供的**命令历史记录 (Command History)** 功能。该功能会自动保存用户输入的命令，不仅方便回顾，还可以通过多种方式被再次调用和编辑，从而减少重复输入，提高工作效率。历史记录默认保存在用户主目录下的 `.bash_history` 文件中。

-----

#### 摘要

##### 1\. 查看和基础调用

  * **查看历史**: 使用 `history` 命令可以列出所有被记录的命令，通常会附带一个编号。
    ```bash
    $ history | less
    ```
  * **按编号执行**: 通过**历史扩展 (History Expansion)**，可以使用 `!` 加上命令编号来重新执行某条历史命令。
    ```bash
    # 假设 history 命令显示 "88 ls -l /usr/bin"
    # 下面的命令会重新执行 "ls -l /usr/bin"
    $ !88
    ```

##### 2\. 搜索历史记录

  * **增量搜索 (Incremental Search)**: 这是最高效的搜索方式。
    1.  ==按 `Ctrl-R` 启动反向增量搜索模式。
    2.  开始输入你想查找的命令中的任意关键词。
    3.  Shell 会实时显示最近一条匹配的历史命令。
    4.  找到后，按 `Enter` 直接执行，或按 `Ctrl-J` 将命令复制到当前行进行编辑。
    5.  可以重复按 `Ctrl-R` 来查找上一个匹配项。
  * **非增量搜索**:
      * **Alt-P**: 输入搜索词后按回车，反向搜索。
      * **Alt-N**: 输入搜索词后按回车，正向搜索。

##### 3\. 键盘快捷键导航

除了使用 `Ctrl-R`，还可以通过以下快捷键在历史记录中导航：

  * **Ctrl-P** 或 **上方向键**: ==移动到上一条命令。
  * **Ctrl-N** 或 **下方向键**: ==移动到下一条命令。
  * **Alt-\<**: 直接跳转到历史记录的开头。
  * **Alt-\>**: 直接跳转到历史记录的末尾（即当前正在编辑的行）。

##### 4\. 更多历史扩展

`!` 字符提供了多种快速执行历史命令的快捷方式：

  * **`!!`**: ==重复执行**上一条**命令=
  * **`!string`**: 重复执行最近一条以 `string` 开头的命令。
  * **`!?string`**: 重复执行最近一条包含 `string` 的命令。

> **注意**: 使用 `!string` 和 `!?string` 时需谨慎，确保执行的是你预期的命令。

##### `script` 命令

除了 Bash 自带的历史记录功能，文末还提到了 `script` 程序。该程序可以记录**整个终端会话**的所有输入和输出，并将其保存到一个文件中，适用于需要完整审计或分享会话记录的场景。
### 10.1 进程的工作方式

本节首先介绍了进程的基本概念。系统启动时，内核会运行一个名为 `init` 的初始进程（其 PID 始终为 1），该进程负责启动系统中的所有其他服务和脚本。程序在运行时会以进程的形式存在，一个进程（父进程）可以创建另一个进程（子进程）。内核会跟踪和管理所有进程，为每个进程分配唯一的**进程 ID (PID)**，并记录其所有者、内存使用等信息。

### 10.2 查看进程

本节重点介绍了两个用于查看和监控系统进程的核心命令：`ps` 和 `top`。

#### `ps` 命令 - 静态查看进程

`ps` 命令用于显示当前系统进程的**静态快照**，即执行命令那一刻的进程状态。

* **基本用法**:
    * `ps`: 默认只显示与当前终端相关的进程（如 `bash` 和 `ps` 命令本身）。
    * `ps x`: 显示当前用户**所有**的进程，无论它们是否关联终端。
    * `ps aux`: **最常用**的组合之一，显示系统上**所有用户**的**所有进程**，并提供非常详细的信息。

* **关键输出列**:
    * `PID`: 进程 ID。
    * `TTY`: 进程的控制终端，`?` 表示无控制终端。
    * `STAT`: 进程状态。常见的状态码包括：
        * `R`: 运行中 (Running)
        * `S`: 睡眠中 (Sleeping)
        * `T`: 已停止 (Stopped)
        * `Z`: 僵尸进程 (Zombie)
    * `%CPU` / `%MEM`: 进程占用的 CPU 和内存百分比。
    * `COMMAND`: 启动进程的命令。

#### `top` 命令 - 动态监控进程

`top` 命令提供了一个**动态、实时**的系统进程视图，默认按 CPU 使用率排序并持续更新。

* **界面布局**: `top` 的输出分为两部分：
    1.  **上半部分 (系统摘要)**: 显示系统的总体状态，包括：
        * 系统运行时间 (`uptime`) 和**平均负载 (load average)**。
        * 进程总数及其状态（运行、睡眠等）。
        * CPU 使用率细分（用户、系统、空闲等）。
        * 物理内存 (`Mem`) 和交换空间 (`Swap`) 的使用情况。
    2.  **下半部分 (进程列表)**: 实时更新的进程列表，默认按 CPU 占用率从高到低排列。

* **交互操作**:
    * `h`: 显示帮助信息。
    * `q`: 退出 `top` 程序。

* **优点**: 与图形化的任务管理器相比，`top` 命令运行速度更快，资源消耗极低，是性能监控的首选工具。


### 10.3 进程控制

本节主要介绍了如何在 Shell 中对进程进行基本的控制，包括中断、在后台运行、在前后台之间切换以及暂停进程。这些操作是命令行多任务处理的基础。

-----

#### 摘要

##### 1\. 前台进程与后台进程

  * **前台进程 (Foreground)**: 当你在终端中执行一个命令（如 `xlogo`），它会默认在前台运行。此时，Shell 会被该进程占用，等待其执行完毕后才会返回命令提示符。
  * **后台进程 (Background)**: 进程也可以在后台运行，这样就不会占用当前的 Shell，你可以立即继续输入其他命令。

##### 2\. 中断进程 (`Ctrl-C`)

  * **功能**: 向当前在前台运行的进程发送一个中断信号，请求其**终止**。
  * **操作**: 在 Shell 窗口中按下 `Ctrl-C` 组合键。
  * **效果**: 大多数命令行程序会响应此信号并退出，Shell 提示符会立即返回。

##### 3\. 将进程置于后台 (`&`)

  * **功能**: 在启动命令时，让它直接在后台运行。
  * **操作**: 在命令的末尾加上一个 `&` 符号。
  * **效果**: 命令会立即开始执行，但 Shell 会马上返回提示符，并显示一个作业号（如 `[1]`）和该进程的 PID。
    ```bash
    # xlogo 将在后台运行，不会占用当前终端
    $ xlogo &
    [1] 28236
    ```
  * **`jobs` 命令**: 可以使用 `jobs` 命令查看当前 Shell 会话中所有在后台运行或已停止的作业列表。

##### 4\. 使进程返回前台 (`fg`)

  * **功能**: 将一个在后台运行或已停止的作业切换到前台。
  * **操作**: 使用 `fg %作业号`。如果只有一个后台作业，可以省略作业号。
    ```bash
    $ fg %1
    ```
  * **效果**: 该进程会回到前台，并重新占用 Shell。此时你可以与它交互或使用 `Ctrl-C` 终止它。

##### 5\. 停止（暂停）进程 (`Ctrl-Z`)

  * **功能**: **暂停**当前正在前台运行的进程，并将其置于后台。这与 `Ctrl-C` (终止) 不同。
  * **操作**: 按下 `Ctrl-Z` 组合键。
  * **效果**: 进程会被挂起，并显示为 "Stopped" 状态。你可以用 `fg` 命令将其恢复到前台继续运行，或使用 `bg` 命令让它在后台继续运行。

##### 6\. 使进程在后台恢复运行 (`bg`)

  * **功能**: 让一个已停止 (Stopped) 的作业在后台**恢复运行**。
  * **操作**: 使用 `bg %作业号`。
    ```bash
    $ bg %1
    ```
  * **效果**: 被暂停的进程会在后台继续执行，`jobs` 命令会显示其状态为 "Running"。

### 10.4 信号

本节深入探讨了进程控制背后的机制——**信号 (Signals)**。信号是操作系统与进程之间进行通信的一种基本方式，用于通知进程发生了某个事件。像 `Ctrl-C` 和 `Ctrl-Z` 这样的键盘快捷键，其本质就是向进程发送特定的信号。

-----

#### 摘要

##### 1\. `kill` - 发送信号给进程

  * **核心功能**: `kill` 命令的主要作用并非字面上的“杀死”进程，而是向指定的进程**发送一个信号**。
  * **默认行为**: 如果不指定信号类型，`kill` 命令默认发送 **`TERM` (终止) 信号**，这是一种可以被程序捕获并进行“善后处理”（如保存工作）的“礼貌”请求。
  * **语法**: `kill -signal PID...`
      * `signal` 可以是信号的**名称** (如 `TERM`, `KILL`) 或**编号** (如 `15`, `9`)。
      * `PID` 是目标进程的进程 ID。也可以使用作业控制的**作业参数** (如 `%1`)。
  * **权限**: 只有进程的属主或超级用户才能向其发送信号。

##### 2\. 常用信号列表

| 编号     | 名称       | 含义和用途                                                       |
| :----- | :------- | :---------------------------------------------------------- |
| **15** | **TERM** | **终止信号 (Terminate)**。`kill` 命令的默认信号，请求进程正常退出。               |
| **9**  | **KILL** | **杀死信号 (Kill)**。这是一个强制信号，由内核直接终止进程，进程无法忽略或处理。应作为**最后手段**使用。 |
| **2**  | **INT**  | **中断信号 (Interrupt)**。与按下 `Ctrl-C` 的效果相同。                    |
| **20** | **TSTP** | **终端停止信号 (Terminal Stop)**。与按下 `Ctrl-Z` 的效果相同，请求进程暂停。       |
| **19** | **STOP** | **停止信号 (Stop)**。强制暂停进程，无法被忽略。                               |
| **18** | **CONT** | **继续信号 (Continue)**。用于恢复一个被 `STOP` 或 `TSTP` 信号暂停的进程。        |
| **1**  | **HUP**  | **挂起信号 (Hang Up)**。常用于通知守护进程（daemon）重新加载其配置文件，而无需重启服务。      |

  * **查看所有信号**: 可以使用 `kill -l` 命令列出系统支持的所有信号。

##### 3\. `killall` - 按名称发送信号

  * **功能**: 与 `kill` 命令不同，`killall` 可以向所有匹配**指定名称**的进程发送信号。这在需要一次性关闭一个程序的所有实例时非常有用。
  * **语法**: `killall [-signal] process_name`
  * **使用案例**:
    ```bash
    # 启动两个 xlogo 实例
    $ xlogo &
    $ xlogo &

    # 使用 killall 一次性终止所有名为 xlogo 的进程
    $ killall xlogo
    ```


### 10.5 关闭系统

本节介绍了用于安全地关闭或重启 Linux 系统的几个核心命令。执行这些命令需要超级用户权限，因为它们会中断所有正在运行的服务和进程。

* **基本命令**:
    * `halt`: 停止系统。
    * `poweroff`: 停止系统并切断电源。
    * `reboot`: 重启系统。
* **`shutdown` 命令 (更灵活)**:
    * 这是功能最强大的关机命令，它允许指定关机或重启的时间，并会在执行前向所有已登录的用户广播警告消息。
    * **常用语法**:
        * `sudo shutdown -h now`: 立即**关机** (halt/poweroff)。
        * `sudo shutdown -r now`: 立即**重启** (reboot)。
        * `sudo shutdown -r +10`: 在 10 分钟后重启。

### 10.6 更多与进程相关的命令

除了 `ps` 和 `top`，本节还介绍了一些其他有用的进程及系统监控工具。

* **`pstree`**: 以**树状图**的形式显示进程列表，清晰地展示进程之间的父子关系。
* **`vmstat`**: 输出关于系统**虚拟内存**、交换空间、磁盘 I/O 等资源的使用情况报告。可以在命令后加上数字（如 `vmstat 5`）使其每隔 5 秒持续输出。
* **`xload`**: 一个**图形化**小程序，用于绘制并显示系统平均负载随时间变化的曲线图。
* **`tload`**: 功能与 `xload` 类似，但它在**终端**内绘制负载曲线图。
### 7.1 扩展

本节介绍了 Shell 的一个核心概念——**扩展 (expansion)**。扩展是指在 Shell 执行命令之前，会对命令行中的特定字符或模式进行处理和替换。通过 `echo` 命令可以清晰地观察到这一过程，例如 `echo *` 并不会输出星号，而是输出当前目录下的所有文件名，因为 Shell 在 `echo` 命令执行前已经将 `*` 扩展成了文件名列表。

-----

#### 摘要

本节详细阐述了六种不同类型的 Shell 扩展：

##### 1\. 路径名扩展 (Pathname Expansion)

  * **功能**: 使用通配符（如 `*`, `?`, `[...]`）来匹配文件名。
  * **注意**: 默认不匹配以点 `.` 开头的隐藏文件。
  * **使用案例**:
    ```bash
    # 假设当前目录下有 Desktop 和 Documents 两个文件夹
    # echo D* 会被扩展为以 "D" 开头的目录和文件名
    $ echo D*
    Desktop Documents
    ```

##### 2\. 浪纹线扩展 (Tilde Expansion)

  * **功能**: 将浪纹线 `~` 符号扩展为主目录路径。
  * **使用案例**:
    ```bash
    # 扩展为当前用户的主目录
    $ echo ~
    /home/me

    # 扩展为用户 foo 的主目录（如果存在该用户）
    $ echo ~foo
    /home/foo
    ```

##### 3\. 算术扩展 (Arithmetic Expansion)

  * **功能**: 在 Shell 中执行整数算术运算。
  * **语法**: `$((expression))`
  * **使用案例**:
    ```bash
    # Shell 会先计算表达式 (5的2次方 * 3)，然后将结果输出
    $ echo $(( (5**2) * 3 ))
    75
    ```

##### 4\. 花括号扩展 (Brace Expansion)

  * **功能**: 根据花括号内的模式生成多个文本字符串，常用于批量创建文件或目录。
  * **语法**: 可以是逗号分隔的列表 `pre{A,B,C}post` 或连续的范围 `pre{1..5}post`。
  * **使用案例**:
    ```bash
    # 此命令会一次性创建从 2007-01 到 2009-12 的所有月份目录
    $ mkdir {2007..2009}-{01..12}

    # 另一个例子：生成一个字符串列表
    $ echo Front-{A,B,C}-Back
    Front-A-Back Front-B-Back Front-C-Back
    ```

##### 5\. 参数扩展 (Parameter Expansion)

  * **功能**: 获取变量 (variable) 中存储的值。
  * **语法**: `$VARIABLE`
  * **使用案例**:
    ```bash
    # 输出存储在 USER 变量中的当前用户名
    $ echo $USER
    me
    ```

##### 6\. 命令替换 (Command Substitution)

  * **功能**: 将一个命令的输出结果作为另一个命令的参数。
  * **语法**: 现代语法是 `$(command)`，旧式语法是 `` `command` ``。
  * **使用案例**:
    ```bash
    # Shell 首先执行 `which cp`，得到结果 /bin/cp
    # 然后将该结果作为参数传给 `ls -l` 命令
    $ ls -l $(which cp)
    -rwxr-xr-x. 1 root root 126584 Apr 18 20:06 /bin/cp
    ```


### 7.2 引用

本节介绍了 Shell 中的**引用 (Quoting)** 机制，其主要目的是控制和禁止 Shell 的扩展功能。当某些特殊字符（如空格、`$`、`*`）需要被当作普通文本处理时，就需要使用引用，以避免意外的单词分割、参数扩展或路径名扩展。

-----

#### 摘要

本节详细阐述了三种主要的引用方法以及一种特殊的转义序列语法：

##### 1\. 双引号 (`"..."`)

  * **功能**: 禁止**大部分**扩展，但保留了部分关键扩展。这是一种“部分引用”或“弱引用”。
  * **被禁止的扩展**:
      * 单词分割 (Word Splitting)：引号内的多个空格和换行符会被保留，整个内容被视为单个参数。
      * 路径名扩展 (Pathname Expansion)：`*` 等通配符会失去特殊含义。
      * 浪纹线扩展 (Tilde Expansion)：`~` 不再扩展为家目录。
      * 花括号扩展 (Brace Expansion)：`{a,b}` 等模式不会被展开。
  * **仍然生效的扩展**:
      * 参数扩展 (`$USER`)
      * 算术扩展 (`$((2+2))`)
      * 命令替换 (`$(cal)`)
  * **使用案例**: 处理包含空格的文件名，或在保留变量的同时保留文本格式。
    ```bash
    # 防止 "two words.txt" 被分割成两个参数
    $ ls -l "two words.txt"

    # 保留 cal 命令输出的换行符和空格格式
    $ echo "$(cal)"
     September 2025
    Su Mo Tu We Th Fr Sa
     1  2  3  4  5  6  7
     8  9 10 11 12 13 14
    15 16 17 18 19 20 21
    22 23 24 25 26 27 28
    29 30
    ```

##### 2\. 单引号 (`'...'`)

  * **功能**: 禁止**所有**扩展。这是一种“完全引用”或“强引用”。单引号内的所有字符都会被当作字面值（literal characters）处理。
  * **使用案例**: 当你希望原封不动地输出一段包含大量特殊字符的文本时。
    ```bash
    # 所有特殊字符都将作为普通文本输出，不会发生任何扩展
    $ echo 'text ~/*.txt {a,b} $(echo foo) $((2+2)) $USER'
    text ~/*.txt {a,b} $(echo foo) $((2+2)) $USER
    ```

##### 3\. 转义字符 (`\`)

  * **功能**: 仅引用紧随其后的**单个字符**，使其失去特殊含义。
  * **使用案例**: 在双引号内取消个别字符的扩展，或处理文件名中包含的特殊字符。
    ```bash
    # 在双引号内，$USER 会被扩展，但 \$5.00 会被当作普通文本
    $ echo "User $USER has \$5.00"
    User me has $5.00

    # 转义文件名中的 "&" 符号
    $ mv bad\ \&filename good_filename
    ```

##### 4\. 反斜线转义序列

  * **功能**: 使用反斜线来表示一些特殊的**控制码**，如换行符或制表符。
  * **语法**: 需要使用 `echo -e` 或 `$'...'` 语法来让 Shell 解释这些序列。
  * **常见序列**: `\n` (新行), `\t` (制表符), `\a` (响铃)。
  * **使用案例**: 在输出中加入格式控制或提示音。
    ```bash
    # 使用 echo 的 -e 选项来解释 \a (响铃) 和 \n (换行)
    $ echo -e "Operation complete.\a\n"

    # 使用 $'' 语法达到同样的效果
    $ echo "Operation complete." $'\a\n'
    ```
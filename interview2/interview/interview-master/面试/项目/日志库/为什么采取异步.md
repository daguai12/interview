### 为什么要异步？和同步的区别是什么？

——同步方式写入日志时，每次调用一次打印日志API就对应一次系统调用write写日志文件。

如果日志打印很频繁，

* 大量的日志打印陷入等量的write**系统调用**，有一定系统开销。

* 另一方面，使得打印日志的进程附带了大量**同步的磁盘IO**，影响性能



若是某条日志信息过大，

* 会**阻塞**日志系统，造成系统瓶颈。



异步方式按我的理解就是主线程的日志打印接口仅负责生产日志数据（作为日志的生产者），而日志的落地操作留给另一个后台线程去完成（作为日志的消费者），这是一个典型的**生产者-消费者**问题。



主线程调用日志打印接口成为**非阻塞操作**，同步的磁盘IO从主线程中剥离出来，有助于提高性能。

对于异步日志，我们很容易借助**队列**来一个实现方式：主线程写日志到队列，队列本身使用条件变量、或者管道、eventfd等通知机制，**当有数据入队列就通知消费者线程去消费日志**。

但是，这样的异步队列也有一定的问题：

* 生产者线程产生N个日志，对应后台线程就会被通知N次，频繁日志写入会造成一定性能开销
* 不同队列实现方式也各有缺点： 
  * 用数组实现：空间不足时，队列内存不易拓展
  * 用链表实现：每条消息的生产消费都对应内存的创建销毁，有一定开销






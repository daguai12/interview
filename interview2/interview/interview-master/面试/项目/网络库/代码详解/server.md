## Server类

这个就是整个网络库的最顶层的类了Server，用户使用该库也是直接使用该类。

简单讲一下，这个类无非就是上面图中的主线程，它创建并监听socket，有连接到来就接受并将其分配给工作线程。一点比较重要的就是Connection对象生命期的管理了。

实际上，我们抽象出来的连接Connection仍旧是由主线程管理的，只不过是把它的函数拿到工作线程上执行，包括消息到达时的处理函数、连接断开的处理函数等。

---

```
client——————————————————————————> 监听socket
                    ——————————————主线程Looper
                    |  Connection
                    |
                    |在looper_1上执行Connection函数
                    |
                ____|____________________________________
                |Looper_1 Looper_2 Looper_3 Looper_4 ...|         
                |               线程池                   |

```

---

那么这里就会产生一个问题，当连接断开时，在Looper_1上如何让Connection对象销毁掉呢？如果直接在连接断开的处理函数里面销毁，不就相当于在自身的函数里销毁自身，显然这样的自杀方式不可取，也不够优雅。

我们的实现是把自杀变成他杀，在连接断开的处理函数里向主线程投放一个任务，请求他把这个Connnection对象销毁掉，这样销毁Connection的工作就由主线程Looper来干，而不是这个Connection自己。

---

```                                                        
                                                    ___________________
client——————————————————————————> 监听socket        |__________________|
                    ——————————————主线程Looper          任务队列
                    |  Connection                            |
                    |                                        |
                    |                                        |把销毁对象的任务交给主线程
                    |                                        | 
                ____|____________________________________    |
                |Looper_1 Looper_2 Looper_3 Looper_4 ...|    |     
                |   |           线程池                   |   |
                    |                                        |
                    |________________________________________|

```

---
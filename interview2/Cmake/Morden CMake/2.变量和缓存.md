## 变量与缓存

### 局部变量

我们先从变量开始说起。一个局部变量的设置方式如下：

```
set(MY_VARIABLE "value")
```

变量名通常是全大写的，值跟在后面。访问变量时用 `${}` 语法，例如 `${MY_VARIABLE}`。
CMake 有 **作用域** 的概念：在同一个作用域内，你可以在设置变量后随时访问它。但如果你离开一个函数，或者离开一个子目录的 CMake 文件，这个变量就不再可用。你可以在 `set` 命令末尾加上 `PARENT_SCOPE`，把变量设置到当前作用域的上一级。

**列表变量** 其实就是一组值：

```
set(MY_LIST one two three)
```

在内部，CMake 会把它们转换成用分号 `;` 分隔的字符串，所以以下写法是等价的：

```
set(MY_LIST "one;two;three")
```

`list()` 命令提供了很多操作列表的工具，`separate_arguments` 可以把用空格分隔的字符串就地转成列表。

注意：如果一个值中没有空格，未加引号和加引号在 CMake 中是等价的，这让你大部分时候可以省略引号。但如果你在处理 **可能包含空格的值**（例如路径），一定要加引号，比如：

```
"${MY_PATH}"
```

而不是：

```
${MY_PATH}
```

### 缓存变量

如果你想在命令行设置变量，CMake 提供了 **缓存变量** 机制。有些变量已经默认在缓存中，比如 `CMAKE_BUILD_TYPE`。

声明一个缓存变量，并在它还未设置时赋值，可以这样写：

```
set(MY_CACHE_VARIABLE "VALUE" CACHE STRING "Description")
```

这**不会**覆盖已有值，这样你就可以在命令行中设置变量，而不会被 CMake 文件执行时覆盖。

如果你想把缓存变量当成“全局变量”来用，可以强制覆盖：

```
set(MY_CACHE_VARIABLE "VALUE" CACHE STRING "" FORCE)
mark_as_advanced(MY_CACHE_VARIABLE)
```

上面第一行会无条件设置变量，第二行会让它在 `cmake -L ..` 或 GUI 变量列表中隐藏。
这种情况很常见，所以也可以用 `INTERNAL` 类型来实现同样效果（实际上它会强制用 STRING 类型，但对依赖该变量的 CMake 代码没有影响）：

```
set(MY_CACHE_VARIABLE "VALUE" CACHE INTERNAL "")
```

对于 `BOOL` 类型变量，可以用更简洁的方式声明：

```
option(MY_OPTION "This is settable from the command line" OFF)
```

`BOOL` 类型的值可以用多种方式表示 `ON` 和 `OFF`。

更多已知变量可以参考 [cmake-variables](https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html)。

### 环境变量

你也可以设置和读取环境变量：

```
set(ENV{variable_name} value)
$ENV{variable_name}
```

但通常不建议在 CMake 中依赖环境变量。

### 缓存文件

缓存实际上就是一个文本文件 `CMakeCache.txt`，它会在你运行 CMake 时生成在构建目录中。
这也是 CMake 记住你设置过的选项的方法，这样你在重新运行 CMake 时就不用重复输入。

### 属性

CMake 另一种存储信息的方式是 **属性**（Properties）。它和变量类似，但附加在某个对象上，比如目录、目标等。**全局属性** 有点像未缓存的全局变量。

许多目标属性会从相应的 `CMAKE_` 前缀变量初始化，比如设置 `CMAKE_CXX_STANDARD` 会让后续新创建的目标自动带上 `CXX_STANDARD` 属性。

两种常见的设置属性的方法：

```
set_property(TARGET TargetName PROPERTY CXX_STANDARD 11)

set_target_properties(TargetName PROPERTIES CXX_STANDARD 11)
```

第一种形式更通用，可以同时设置多个目标/文件/测试，并且有更多选项。
第二种是针对单个目标设置多个属性的简写形式。

获取属性的写法：

```
get_property(ResultVariable TARGET TargetName PROPERTY CXX_STANDARD)
```

更多已知属性参考 [cmake-properties](https://cmake.org/cmake/help/latest/manual/cmake-properties.7.html)。在某些情况下，你也可以自定义属性。

---

如果你愿意，我可以帮你把下一节 **Targets are your friend** 也翻译出来，这样整个 CMake 基础部分会更完整。你是要继续吗？

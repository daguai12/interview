好，我帮你彻底定位一下。
你这里的现象是：`gtest_discover_tests()` 执行后，`ctest -N` 还是显示 **No tests were found!!!**。

---

## 🔎 常见几个坑

1. **`enable_testing()` 调用顺序**
   必须在 **add\_subdirectory(test)** 之前调用，或者至少在 `gtest_discover_tests()` 之前 CMake 里启用测试。
   你的顶层写的是：

   ```cmake
   add_subdirectory(third_party)
   add_subdirectory(test)

   enable_testing()
   ```

   👉 这里顺序反了，CTest 在进入 `test/` 时还没启用。
   正确写法：

   ```cmake
   enable_testing()
   add_subdirectory(third_party)
   add_subdirectory(test)
   ```

---

2. **main() 冲突**

   * 如果 `test1.cpp` 里自己写了 `main()`，就只能用 `add_test()` 手工注册。
   * 如果要用 `gtest_discover_tests()`，就必须删掉 `main()` 并且链接 `gtest_main`。

---

3. **二进制执行目录问题**
   `gtest_discover_tests()` 会在配置阶段执行：

   ```
   <binary_path>/test1 --gtest_list_tests
   ```

   如果 `RUNTIME_OUTPUT_DIRECTORY` 设置错误，或者可执行文件没生成到那个目录，就会失败。

   我看到你写了：

   ```cmake
   set_target_properties(${test_name}
       PROPERTIES
       RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/test"
   )
   ```

   这是对的，但确认一下二进制确实在 `build/test/test1`。

---

## ✅ 最小可运行 Demo

### 顶层 CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.15)
project(gtest_gmock)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

enable_testing()

add_subdirectory(third_party)
add_subdirectory(test)
```

### test/CMakeLists.txt

```cmake
include(GoogleTest)

file(GLOB TEST_FILE_SOURCE "${PROJECT_SOURCE_DIR}/test/*.cpp")

foreach(test_file_source ${TEST_FILE_SOURCE})
    get_filename_component(test_file_name ${test_file_source} NAME)
    string(REPLACE ".cpp" "" test_name ${test_file_name})

    add_executable(${test_name} ${test_file_source})
    target_link_libraries(${test_name} gtest gtest_main pthread)

    gtest_discover_tests(${test_name}
        EXTRA_ARGS --gtest_color=auto
        WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/test
    )

    set_target_properties(${test_name}
        PROPERTIES
        RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/test"
    )
endforeach()
```

### test/test1.cpp

```cpp
#include <gtest/gtest.h>

int add(int num1, int num2) {
    return num1 + num2;
}

TEST(SumTest, ForPositiveNumbers) {
    EXPECT_EQ(35, add(23,12));
}

TEST(SumTest, ForNegativeNumbers) {
    EXPECT_EQ(-1, add(-1,0));
}

TEST(SumTest, ForMixNumbers) {
    EXPECT_EQ(0, add(-1,1));
}
```

---

## 🚀 构建&运行

```bash
mkdir build && cd build
cmake ..
make -j$(nproc)

ctest -N          # 现在应该能看到 3 个测试
ctest -R test1 -V # 运行 test1 的所有测试
```

---

👉 我猜你之前的主要问题是 **`enable_testing()` 调用太晚** + **还自己写了 main()**。
你要不要我帮你验证一下你的 `build/CMakeFiles/test1[.dir]/.../CTestTestfile.cmake` 里是不是空的？这能确认是不是注册阶段没执行成功。

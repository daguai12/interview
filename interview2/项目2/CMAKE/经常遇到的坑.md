å¥½ï¼Œæˆ‘å¸®ä½ å½»åº•å®šä½ä¸€ä¸‹ã€‚
ä½ è¿™é‡Œçš„ç°è±¡æ˜¯ï¼š`gtest_discover_tests()` æ‰§è¡Œåï¼Œ`ctest -N` è¿˜æ˜¯æ˜¾ç¤º **No tests were found!!!**ã€‚

---

## ğŸ” å¸¸è§å‡ ä¸ªå‘

1. **`enable_testing()` è°ƒç”¨é¡ºåº**
   å¿…é¡»åœ¨ **add\_subdirectory(test)** ä¹‹å‰è°ƒç”¨ï¼Œæˆ–è€…è‡³å°‘åœ¨ `gtest_discover_tests()` ä¹‹å‰ CMake é‡Œå¯ç”¨æµ‹è¯•ã€‚
   ä½ çš„é¡¶å±‚å†™çš„æ˜¯ï¼š

   ```cmake
   add_subdirectory(third_party)
   add_subdirectory(test)

   enable_testing()
   ```

   ğŸ‘‰ è¿™é‡Œé¡ºåºåäº†ï¼ŒCTest åœ¨è¿›å…¥ `test/` æ—¶è¿˜æ²¡å¯ç”¨ã€‚
   æ­£ç¡®å†™æ³•ï¼š

   ```cmake
   enable_testing()
   add_subdirectory(third_party)
   add_subdirectory(test)
   ```

---

2. **main() å†²çª**

   * å¦‚æœ `test1.cpp` é‡Œè‡ªå·±å†™äº† `main()`ï¼Œå°±åªèƒ½ç”¨ `add_test()` æ‰‹å·¥æ³¨å†Œã€‚
   * å¦‚æœè¦ç”¨ `gtest_discover_tests()`ï¼Œå°±å¿…é¡»åˆ æ‰ `main()` å¹¶ä¸”é“¾æ¥ `gtest_main`ã€‚

---

3. **äºŒè¿›åˆ¶æ‰§è¡Œç›®å½•é—®é¢˜**
   `gtest_discover_tests()` ä¼šåœ¨é…ç½®é˜¶æ®µæ‰§è¡Œï¼š

   ```
   <binary_path>/test1 --gtest_list_tests
   ```

   å¦‚æœ `RUNTIME_OUTPUT_DIRECTORY` è®¾ç½®é”™è¯¯ï¼Œæˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶æ²¡ç”Ÿæˆåˆ°é‚£ä¸ªç›®å½•ï¼Œå°±ä¼šå¤±è´¥ã€‚

   æˆ‘çœ‹åˆ°ä½ å†™äº†ï¼š

   ```cmake
   set_target_properties(${test_name}
       PROPERTIES
       RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/test"
   )
   ```

   è¿™æ˜¯å¯¹çš„ï¼Œä½†ç¡®è®¤ä¸€ä¸‹äºŒè¿›åˆ¶ç¡®å®åœ¨ `build/test/test1`ã€‚

---

## âœ… æœ€å°å¯è¿è¡Œ Demo

### é¡¶å±‚ CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.15)
project(gtest_gmock)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

enable_testing()

add_subdirectory(third_party)
add_subdirectory(test)
```

### test/CMakeLists.txt

```cmake
include(GoogleTest)

file(GLOB TEST_FILE_SOURCE "${PROJECT_SOURCE_DIR}/test/*.cpp")

foreach(test_file_source ${TEST_FILE_SOURCE})
    get_filename_component(test_file_name ${test_file_source} NAME)
    string(REPLACE ".cpp" "" test_name ${test_file_name})

    add_executable(${test_name} ${test_file_source})
    target_link_libraries(${test_name} gtest gtest_main pthread)

    gtest_discover_tests(${test_name}
        EXTRA_ARGS --gtest_color=auto
        WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/test
    )

    set_target_properties(${test_name}
        PROPERTIES
        RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/test"
    )
endforeach()
```

### test/test1.cpp

```cpp
#include <gtest/gtest.h>

int add(int num1, int num2) {
    return num1 + num2;
}

TEST(SumTest, ForPositiveNumbers) {
    EXPECT_EQ(35, add(23,12));
}

TEST(SumTest, ForNegativeNumbers) {
    EXPECT_EQ(-1, add(-1,0));
}

TEST(SumTest, ForMixNumbers) {
    EXPECT_EQ(0, add(-1,1));
}
```

---

## ğŸš€ æ„å»º&è¿è¡Œ

```bash
mkdir build && cd build
cmake ..
make -j$(nproc)

ctest -N          # ç°åœ¨åº”è¯¥èƒ½çœ‹åˆ° 3 ä¸ªæµ‹è¯•
ctest -R test1 -V # è¿è¡Œ test1 çš„æ‰€æœ‰æµ‹è¯•
```

---

ğŸ‘‰ æˆ‘çŒœä½ ä¹‹å‰çš„ä¸»è¦é—®é¢˜æ˜¯ **`enable_testing()` è°ƒç”¨å¤ªæ™š** + **è¿˜è‡ªå·±å†™äº† main()**ã€‚
ä½ è¦ä¸è¦æˆ‘å¸®ä½ éªŒè¯ä¸€ä¸‹ä½ çš„ `build/CMakeFiles/test1[.dir]/.../CTestTestfile.cmake` é‡Œæ˜¯ä¸æ˜¯ç©ºçš„ï¼Ÿè¿™èƒ½ç¡®è®¤æ˜¯ä¸æ˜¯æ³¨å†Œé˜¶æ®µæ²¡æ‰§è¡ŒæˆåŠŸã€‚

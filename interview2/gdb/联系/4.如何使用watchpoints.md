å¥½çš„ ğŸ‘ æˆ‘æ¥å¸®ä½ å†™ä¸€ä¸ªå®Œæ•´çš„æ¡ˆä¾‹ï¼ŒæŠŠä½ æåˆ°çš„ **æ‰€æœ‰ watchpoint åŠŸèƒ½ï¼ˆwriteã€readã€read/writeã€disableï¼‰** éƒ½ä¸²èµ·æ¥æ¼”ç¤ºã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ C ç¨‹åºï¼Œç„¶ååœ¨ gdb é‡Œä¸€æ­¥æ­¥è®¾ç½®ã€‚

---

## ç¤ºä¾‹ç¨‹åºï¼š`watch_demo.c`

```c
#include <stdio.h>

int main(int argc, char **argv) {
    int x = 30;
    int y = 10;

    x = y;         // ç¬¬ä¸€æ¬¡ä¿®æ”¹ x
    y = x + 5;     // ä¿®æ”¹ y
    int z = x + y; // è¯» x å’Œ y
    x = z;         // ç¬¬äºŒæ¬¡ä¿®æ”¹ x

    printf("x=%d, y=%d, z=%d\n", x, y, z);
    return 0;
}
```

ç¼–è¯‘ï¼š

```bash
gcc -g watch_demo.c -o watch_demo
```

---

## GDB è°ƒè¯•æ¼”ç¤º

### 1. å¯åŠ¨ GDB å¹¶è®¾ç½®æ–­ç‚¹

```gdb
gdb ./watch_demo
(gdb) break main
Breakpoint 1 at 0x1149: file watch_demo.c, line 5.
(gdb) run
Breakpoint 1, main (argc=1, argv=0x7fffffff) at watch_demo.c:5
5       int x = 30;
```

æ­¤æ—¶åœåœ¨ `main`ï¼Œå˜é‡ `x` å’Œ `y` åœ¨ä½œç”¨åŸŸå†…ï¼Œå¯ä»¥è®¾ç½® watchpointsã€‚

---

### 2. è®¾ç½® **å†™ watchpoint**ï¼ˆwatchï¼‰

ç›‘è§† `x` çš„å†™æ“ä½œï¼š

```gdb
(gdb) watch x
Hardware watchpoint 2: x
```

ç»§ç»­æ‰§è¡Œï¼š

```gdb
(gdb) continue
Hardware watchpoint 2: x

Old value = 30
New value = 10
main (argc=1, argv=0x7fffffff) at watch_demo.c:9
9       y = x + 5;
```

è¯´æ˜åœ¨ `x = y;` å¤„è§¦å‘äº†å†™æ“ä½œã€‚

---

### 3. è®¾ç½® **è¯» watchpoint**ï¼ˆrwatchï¼‰

ç›‘è§† `y` çš„è¯»æ“ä½œï¼š

```gdb
(gdb) rwatch y
Hardware read watchpoint 3: y
```

ç»§ç»­æ‰§è¡Œï¼š

```gdb
(gdb) continue
Hardware read watchpoint 3: y

Value = 10
main (argc=1, argv=0x7fffffff) at watch_demo.c:9
9       y = x + 5;
```

è¯´æ˜åœ¨ `y = x + 5;` å³è¾¹çš„ `x + 5` æ—¶è¯»å–äº† `y`ã€‚

---

### 4. è®¾ç½® **è¯»/å†™ watchpoint**ï¼ˆawatchï¼‰

ç›‘è§† `z` çš„è¯»/å†™æ“ä½œï¼š

```gdb
(gdb) awatch z
Hardware access (read/write) watchpoint 4: z
```

ç»§ç»­æ‰§è¡Œï¼š

```gdb
(gdb) continue
Hardware access (read/write) watchpoint 4: z

Old value = -1
New value = 25
main (argc=1, argv=0x7fffffff) at watch_demo.c:11
11      x = z;
```

ï¼ˆz ç¬¬ä¸€æ¬¡è¢«èµ‹å€¼ï¼Œè§¦å‘äº†å†™ï¼‰

---

### 5. æŸ¥çœ‹ watchpoints åˆ—è¡¨

```gdb
(gdb) info breakpoints
Num Type           Disp Enb Address    What
1   breakpoint     keep y   0x00001149 in main at watch_demo.c:5
2   hw watchpoint  keep y              x
3   read watchpoint keep y              y
4   acc watchpoint keep y              z
```

---

### 6. ç¦ç”¨æŸä¸ª watchpoint

ä¾‹å¦‚ç¦ç”¨ `x` çš„å†™ç›‘è§†ï¼ˆç¼–å· 2ï¼‰ï¼š

```gdb
(gdb) disable 2
(gdb) info breakpoints
Num Type           Disp Enb Address    What
1   breakpoint     keep y   0x00001149 in main at watch_demo.c:5
2   hw watchpoint  keep n              x
3   read watchpoint keep y              y
4   acc watchpoint keep y              z
```

å¯ä»¥çœ‹åˆ° watchpoint `2` å·²ç»è¢«ç¦ç”¨ï¼ˆEnb=nï¼‰ã€‚

---

âœ… è¿™æ ·æˆ‘ä»¬å°±å®Œæ•´æ¼”ç¤ºäº†ï¼š

* **å†™ watchpoint** (`watch`)
* **è¯» watchpoint** (`rwatch`)
* **è¯»/å†™ watchpoint** (`awatch`)
* **ç¦ç”¨ watchpoint** (`disable`)

---

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª **ä¸€é”®è¿è¡Œçš„ GDB è„šæœ¬**ï¼ˆç”¨ `gdb -x script.gdb ./watch_demo` ç›´æ¥æ¼”ç¤ºæ‰€æœ‰æ“ä½œï¼‰ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨æ¯æ¬¡æ‰‹åŠ¨æ•²å‘½ä»¤äº†ï¼Ÿ

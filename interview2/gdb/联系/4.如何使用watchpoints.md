好的 👍 我来帮你写一个完整的案例，把你提到的 **所有 watchpoint 功能（write、read、read/write、disable）** 都串起来演示。我们用一个简单的 C 程序，然后在 gdb 里一步步设置。

---

## 示例程序：`watch_demo.c`

```c
#include <stdio.h>

int main(int argc, char **argv) {
    int x = 30;
    int y = 10;

    x = y;         // 第一次修改 x
    y = x + 5;     // 修改 y
    int z = x + y; // 读 x 和 y
    x = z;         // 第二次修改 x

    printf("x=%d, y=%d, z=%d\n", x, y, z);
    return 0;
}
```

编译：

```bash
gcc -g watch_demo.c -o watch_demo
```

---

## GDB 调试演示

### 1. 启动 GDB 并设置断点

```gdb
gdb ./watch_demo
(gdb) break main
Breakpoint 1 at 0x1149: file watch_demo.c, line 5.
(gdb) run
Breakpoint 1, main (argc=1, argv=0x7fffffff) at watch_demo.c:5
5       int x = 30;
```

此时停在 `main`，变量 `x` 和 `y` 在作用域内，可以设置 watchpoints。

---

### 2. 设置 **写 watchpoint**（watch）

监视 `x` 的写操作：

```gdb
(gdb) watch x
Hardware watchpoint 2: x
```

继续执行：

```gdb
(gdb) continue
Hardware watchpoint 2: x

Old value = 30
New value = 10
main (argc=1, argv=0x7fffffff) at watch_demo.c:9
9       y = x + 5;
```

说明在 `x = y;` 处触发了写操作。

---

### 3. 设置 **读 watchpoint**（rwatch）

监视 `y` 的读操作：

```gdb
(gdb) rwatch y
Hardware read watchpoint 3: y
```

继续执行：

```gdb
(gdb) continue
Hardware read watchpoint 3: y

Value = 10
main (argc=1, argv=0x7fffffff) at watch_demo.c:9
9       y = x + 5;
```

说明在 `y = x + 5;` 右边的 `x + 5` 时读取了 `y`。

---

### 4. 设置 **读/写 watchpoint**（awatch）

监视 `z` 的读/写操作：

```gdb
(gdb) awatch z
Hardware access (read/write) watchpoint 4: z
```

继续执行：

```gdb
(gdb) continue
Hardware access (read/write) watchpoint 4: z

Old value = -1
New value = 25
main (argc=1, argv=0x7fffffff) at watch_demo.c:11
11      x = z;
```

（z 第一次被赋值，触发了写）

---

### 5. 查看 watchpoints 列表

```gdb
(gdb) info breakpoints
Num Type           Disp Enb Address    What
1   breakpoint     keep y   0x00001149 in main at watch_demo.c:5
2   hw watchpoint  keep y              x
3   read watchpoint keep y              y
4   acc watchpoint keep y              z
```

---

### 6. 禁用某个 watchpoint

例如禁用 `x` 的写监视（编号 2）：

```gdb
(gdb) disable 2
(gdb) info breakpoints
Num Type           Disp Enb Address    What
1   breakpoint     keep y   0x00001149 in main at watch_demo.c:5
2   hw watchpoint  keep n              x
3   read watchpoint keep y              y
4   acc watchpoint keep y              z
```

可以看到 watchpoint `2` 已经被禁用（Enb=n）。

---

✅ 这样我们就完整演示了：

* **写 watchpoint** (`watch`)
* **读 watchpoint** (`rwatch`)
* **读/写 watchpoint** (`awatch`)
* **禁用 watchpoint** (`disable`)

---

要不要我帮你写一个 **一键运行的 GDB 脚本**（用 `gdb -x script.gdb ./watch_demo` 直接演示所有操作），这样你就不用每次手动敲命令了？

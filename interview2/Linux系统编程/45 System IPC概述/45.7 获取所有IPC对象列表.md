### **45.7 获取所有 IPC 对象列表**

Linux 提供了两种获取系统上所有 System V IPC 对象列表的非标准方法：

1.  读取 `/proc/sysvipc` 目录中的文件。
2.  使用 Linux 特有的 `ctl` 调用（将在 46.6 节介绍）。

本节将介绍 `/proc/sysvipc` 目录中的文件。

#### **使用 `/proc/sysvipc` 文件**

`/proc/sysvipc` 目录中包含三个只读的虚拟文件，它们提供的信息与 `ipcs` 命令类似：

  * `/proc/sysvipc/msg`: 列出所有消息队列及其特性。
  * `/proc/sysvipc/sem`: 列出所有信号量集及其特性。
  * `/proc/sysvipc/shm`: 列出所有共享内存段及其特性。

##### **与 `ipcs` 命令的区别**

一个关键的区别在于权限：

  * `ipcs` 命令（在 Linux 上）只显示出当前用户拥有**读权限**的 IPC 对象。
  * 而读取 `/proc/sysvipc` 目录下的这些文件则会显示出相应种类的**所有**对象，**不管当前用户是否在这些对象上拥有读权限**。

下面给出了一个 `/proc/sysvipc/sem` 文件的内容示例（为排版需要，省略了部分空格）：

```
       key      semid perms      nsems   uid   gid  cuid  cgid      otime      ctime
0x00000000      65536  666           1   500   100   500   100 1132172777 1132172777
0x00000000      98305  666           1   500   100   500   100 1132172777 1132172777
```

这些 `/proc/sysvipc` 文件为程序和脚本提供了一种遍历给定种类的所有现有 IPC 对象的方法，但这种方法是**不可移植**的。

#### **可移植性建议**

获取给定种类的所有 IPC 对象的**最佳可移植做法**是**解析 `ipcs(1)` 命令的输出**。
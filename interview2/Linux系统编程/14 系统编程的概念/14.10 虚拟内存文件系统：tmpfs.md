好的，这是根据您提供的文本内容，保留原始结构和标题整理的结果。

### **14.10 虚拟内存文件系统：tmpfs**

到目前为止，本章已论及的所有文件系统均驻留在磁盘之上。然而，Linux 同样支持驻留于内存中的**虚拟文件系统**。对应用程序来说，此类文件系统看起来与任何其他文件系统别无二致——可施以相同操作（`open()`, `read()`, `write()`, `mkdir()` 等）。不过，二者之间存在一个重要差别：由于不涉及磁盘访问，虚拟文件系统的文件操作速度极快。

在 Linux 上，`tmpfs` 文件系统是迄今为止最为复杂的基于内存的文件系统，它在 Linux 2.4 中首度出现。较之于其他基于内存的文件系统（如 ramdisk），其独特之处在于它属于**虚拟内存文件系统**。这意味着，该文件系统不但使用 RAM，而且在 RAM 耗尽的情况下，还会利用**交换空间 (swap space)**。

#### **如何使用 tmpfs**

`tmpfs` 文件系统是一个 Linux 内核的可选组件。要创建一个 `tmpfs` 文件系统，请使用如下形式的命令：

```bash
# mount -t tmpfs source target
```

  * **`source`**: 可以是任意名称，其唯一的意义是在 `/proc/mounts` 中显示，并没有实际对应的设备。
  * **`target`**: 该文件系统的挂载点。
  * **无需 `mkfs`**: `tmpfs` 不需要预先使用 `mkfs` 创建文件系统，内核会在执行 `mount()` 系统调用时自动完成初始化。

作为 `tmpfs` 的一个典型应用，可以使用堆叠挂载（见 14.9.2 节）的方式，将一个 `tmpfs` 文件系统挂载到 `/tmp` 目录，以提高编译器等频繁使用临时文件的应用程序的性能：

```bash
# mount -t tmpfs tmpfs /tmp
```

#### **大小和持久性**

  * **大小**: 默认情况下，允许 `tmpfs` 文件系统的大小增长至系统 RAM 容量的一半。但在挂载时，可使用 `size=nbytes` 选项为其大小设置一个不同的上限值。`tmpfs` 文件系统仅会根据其当前所持有的文件来消耗内存和交换空间，并不会预先分配所有空间。
  * **持久性**: `tmpfs` 是**易失的 (volatile)**。一旦卸载 `tmpfs` 文件系统，或者遭遇系统崩溃，那么该文件系统中的所有数据都将丢失，“tmpfs” 正是得名于此（temporary file system）。

#### **特殊用途**

除了用于用户应用程序以外，`tmpfs` 文件系统还有以下两个特殊的系统级用途：

  * 由内核内部挂载一个隐形的 `tmpfs` 文件系统，用于实现 **System V 共享内存**（第 48 章）和**共享匿名内存映射**（第 49 章）。
  * 一个 `tmpfs` 文件系统被挂载于 `/dev/shm`，供 `glibc` 库用以实现 **POSIX 共享内存**和 **POSIX 信号量**。
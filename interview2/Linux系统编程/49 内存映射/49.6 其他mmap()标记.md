### **49.6 其他 mmap()标记**

除了 `MAP_PRIVATE` 和 `MAP_SHARED` 之外，Linux 允许在 `mmap()` 的 `flags` 参数中“或”上其他一些值。下表对此进行了总结。

**表 49-3：`mmap()` `flags` 参数的位掩码值**

| 值                   | 描述                             | SUSv3 |
| :------------------ | :----------------------------- | :---: |
| `MAP_ANONYMOUS`     | 创建一个匿名映射                       |       |
| `MAP_FIXED`         | 原样解释 `addr` 参数 (49.10 节)       |   ✓   |
| `MAP_HUGETLB`       | 创建一个使用巨页的映射 (自 Linux 2.6.32 起) |       |
| `MAP_LOCKED`        | 将映射分页锁进内存 (自 Linux 2.6 起)      |       |
| `MAP_NORESERVE`     | 控制交换空间的预留 (49.9 节)             |       |
| `MAP_POPULATE`      | 填充一个映射的分页 (自 Linux 2.6 起)      |       |
| `MAP_PRIVATE`       | 对映射数据的修改是私有的                   |   ✓   |
| `MAP_SHARED`        | 发生在映射数据上的变更对其他进程可见并会被反映到底层文件上  |   ✓   |
| `MAP_UNINITIALIZED` | 不清除匿名映射 (自 Linux 2.6.33 起)     |       |

---
#### **标志详解**
下面提供了与上表中列出的 `flags` 值有关的更多细节信息。

* **`MAP_ANONYMOUS`**:
    创建一个**匿名映射**，即没有底层文件对应的映射。将在 49.7 节中对此进行深入介绍。

* **`MAP_FIXED`**:
    将在 49.10 节中对此进行介绍。

* **`MAP_HUGETLB`** (自 Linux 2.6.32 起):
    创建一个使用**巨页 (huge pages)** 的映射，以提高性能，其作用与 System V 共享内存的 `SHM_HUGETLB` 标记类似。

* **`MAP_LOCKED`** (自 Linux 2.6 起):
    预加载映射分页并将映射分页**锁进内存**，效果类似于调用 `mlock()`。

* **`MAP_NORESERVE`**:
    这个标记用来控制是否为映射的交换空间执行**预留**操作。细节信息请参见 49.9 节。

* **`MAP_POPULATE`** (自 Linux 2.6 起):
    **预先填充**一个映射的分页。对于文件映射，这会在文件上执行一个**超前读取 (read-ahead)**。这意味着后续对映射内容的访问不会因缺页中断而发生阻塞。

* **`MAP_UNINITIALIZED`** (自 Linux 2.6.33 起):
    指定这个标记会**阻止**内核将一个匿名映射**清零**。
    * **优点**: 能够带来性能上的提升。
    * **风险**: 带来了**安全风险**，因为新分配的分页中可能会包含上一个进程留下来的敏感信息。
    * **用途**: 因此这个标记一般只供嵌入式系统使用，在这些系统中，性能至关重要，并且整个系统都处于应用程序的控制之下。
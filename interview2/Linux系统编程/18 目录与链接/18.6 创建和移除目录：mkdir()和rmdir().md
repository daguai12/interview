### **18.6 创建和移除目录：mkdir()和 rmdir()**

#### **mkdir()**

`mkdir()` 系统调用创建一个新目录。

```c
#include <sys/stat.h>

int mkdir(const char *pathname, mode_t mode);
```

  * **`pathname`**: 新目录的路径名。
  * **`mode`**: 指定新目录的权限。
  * **错误**: 若具有该路径名的文件或目录已经存在，则调用失败，`errno` 被置为 `EEXIST`。
  * **所有权**: 新目录的所有权设置遵循 15.3.1 节所述的规则。

##### **权限处理**

1.  **`umask`**: `mode` 参数指定的初始权限会与进程的 `umask` 进行按位与非操作 (`mode & ~umask`)，从而得到最终的权限。
2.  **特殊权限位**:
      * **`set-user-ID` 位**: 对于目录毫无意义，因此在新建目录时**始终被关闭**。
      * **`sticky` 位 (`S_ISVTX`)**: 如果在 `mode` 中设置了，那么新目录也将被设置该权限。
      * **`set-group-ID` 位 (`S_ISGID`)**: 在 `mode` 中设置此位**会被忽略**。相反，新目录会**继承其父目录的 `set-group-ID` 位**。这种继承机制确保了在一个设置了 `set-group-ID` 的项目目录下，所有新建的子目录都保持相同的组所有权继承行为。

##### **其他特性**

  * **默认条目**: 新建的目录会自动包含两个条目：`.` (点)，即指向目录自身的链接；和 `..` (点点)，即指向父目录的链接。
  * **路径创建**: `mkdir()` 系统调用**仅创建**路径名中的最后一部分。也就是说，`mkdir("a/b/c", mode)` 仅当目录 `a` 和 `a/b` 已经存在的情况下才会成功。（这与 `mkdir -p` 命令不同）。
  * **`mkdtemp()`**: GNU C 语言库提供了一个非标准的 `mkdtemp(template)` 函数，它是 `mkstemp()` 的目录版。该函数会根据一个模板字符串创建一个唯一命名的临时目录，权限为 `0700` (`rwx------`)。

#### **rmdir()**

`rmdir()` 系统调用移除一个目录。

```c
#include <unistd.h>

int rmdir(const char *pathname);
```

  * **移除条件**: 要使 `rmdir()` 调用成功，被删除的目录**必须为空**。
  * **符号链接**: `rmdir()` **不会**对符号链接进行解引用。如果 `pathname` 是一个指向目录的符号链接，`rmdir()` 调用将失败，并将 `errno` 置为 `ENOTDIR`，因为它操作的对象不是一个真正的目录。
### **59.5 主机和服务转换函数概述**

计算机以二进制形式表示 IP 地址和端口号，但人们发现使用符号名（如 `www.kernel.org`）和展现格式（如 `198.51.100.1`）更容易记忆和使用。本节将概述用于在这些不同表示法之间进行转换的库函数，并将它们分为**“现代”**和**“已过时”**两类。

---
#### **在二进制与“可读”IP地址格式之间转换**
这类函数用于在二进制 IP 地址和其文本展现格式（IPv4 的点分十进制，IPv6 的十六进制字符串）之间进行转换。

* **已过时 (仅限 IPv4)**:
    * `inet_aton()`, `inet_ntoa()`: 这些函数只能处理 IPv4 地址，现已被废弃。新程序中应避免使用。

* **现代 (支持 IPv4 和 IPv6)**:
    * **`inet_pton()`**: 将**展现格式 (presentation)** 转换为**网络二进制格式 (network)**。
    * **`inet_ntop()`**: 将**网络二进制格式 (network)** 转换为**展现格式 (presentation)**。
    * **用途**: `inet_ntop()` 的一个常见用途是在日志中记录 IP 地址，这样做可以避免执行一个可能耗时很长或失败的 DNS 反向解析来获取主机名。

---
#### **在二进制与“主机/服务名称”之间转换**
这类函数用于在二进制 IP 地址/端口号和其符号名（主机名和服务名）之间进行转换，通常需要与 DNS 等服务进行交互。

* **已过时**:
    * `gethostbyname()`: 主机名 -> IP 地址
    * `getservbyname()`: 服务名 -> 端口号
    * `gethostbyaddr()`: IP 地址 -> 主机名
    * `getservbyport()`: 端口号 -> 服务名
    * 这些函数存在很多问题（例如，不支持 IPv6，线程不安全），已被 SUSv3 标记为过时，SUSv4 则直接删除了它们的规范。**新代码中绝对不应使用**。

* **现代**:
    * **`getaddrinfo()`**: 这是 `gethostbyname()` 和 `getservbyname()` 两个函数的现代继任者。
        * **功能**: 给定一个主机名和一个服务名，它会返回一组包含相应二进制 IP 地址和端口号的 socket 地址结构。
        * **最大优势**: 能够**透明地处理 IPv4 和 IPv6 地址**。使用这个函数可以轻松编写不依赖于特定 IP 版本的网络程序。**所有新代码都应该使用 `getaddrinfo()`**。
    * **`getnameinfo()`**: 这是 `gethostbyaddr()` 和 `getservbyport()` 的现代继任者。
        * **功能**: 执行逆向转换，即将一个二进制 IP 地址和端口号转换成对应的主机名和服务名。

---
### **总结表**

| 任务 (Task)            | 已过时/不推荐 (Obsolete/Not Recommended)   | **现代/推荐 (Modern/Recommended)**  |
| :------------------- | :----------------------------------- | :------------------------------ |
| **文本 IP -> 二进制 IP**  | `inet_aton()` (仅 IPv4)               | **`inet_pton()` (IPv4/IPv6)**   |
| **二进制 IP -> 文本 IP**  | `inet_ntoa()` (仅 IPv4)               | **`inet_ntop()` (IPv4/IPv6)**   |
| **主机名/服务名 -> 二进制地址** | `gethostbyname()`, `getservbyname()` | **`getaddrinfo()` (IPv4/IPv6)** |
| **二进制地址 -> 主机名/服务名** | `gethostbyaddr()`, `getservbyport()` | **`getnameinfo()` (IPv4/IPv6)** |

### **59.14 UNIX 与 Internet domain socket 比较**

当编写需要通过网络进行通信的应用程序时，必须使用 Internet domain socket。但当位于**同一系统**上的应用程序需要使用 socket 进行通信时，则可以选择使用 Internet domain socket（例如，连接到环回地址 `127.0.0.1`）或 UNIX domain socket。

在这种情况下该使用哪个 domain 呢？

---

#### **选择 Internet Domain Socket 的理由**

* **简单性和通用性**: 编写只使用 Internet domain socket 的应用程序通常是最简单的做法，因为同一套代码既能用于同一主机上的进程间通信，也能无缝地扩展到网络中的不同主机上进行通信。

---

#### **选择 UNIX Domain Socket 的理由**

尽管 Internet domain socket 更通用，但在确定通信**仅限于同一台主机**时，选择使用 UNIX domain socket 存在几个重要的优势：

1.  **性能 (Performance)**:
    * 在一些实现上，UNIX domain socket 的速度比 Internet domain socket 的速度要快。这是因为 UNIX domain socket 的通信完全在内核中进行，无需经过完整的 TCP/IP 协议栈（例如，不需要进行封包、计算校验和、路由等操作）。

2.  **访问控制 (Access Control)**:
    * 可以使用标准的文件系统**目录和文件权限**来控制对 UNIX domain socket 的访问。
    * 这为验证客户端提供了一个简单而强大的方法。例如，可以将 socket 文件放置在一个特定用户组才能访问的目录中，从而只允许该组的成员连接到服务器。而使用 Internet domain socket 实现同等级别的客户端验证则需要做更多的应用层开发工作。

3.  **高级特性 (Advanced Features)**:
    * 使用 UNIX domain socket 可以在进程间**传递打开的文件描述符**。
    * 可以在通信时可靠地**发送和接收发送者的身份凭证**（如用户 ID 和组 ID）。

#### **总结**

| 特性 | Internet Domain Socket (本地通信) | **UNIX Domain Socket (推荐用于本地通信)** |
| :--- | :--- | :--- |
| **性能** | 良好 (需要经过 TCP/IP 协议栈) | **更佳** (直接通过内核，开销更小) |
| **访问控制**| 复杂 (需在应用层实现) | **简单** (可利用标准的文件系统权限) |
| **高级功能**| 不支持 | **支持** (传递文件描述符、进程凭证) |
| **位置透明性**| **是** (一套代码，本地远程通用) | 否 (仅限本机) |

**结论**: 如果你的应用程序明确只需要在同一台主机上的进程间进行通信，那么 **UNIX domain socket 通常是更好的选择**。
### **59.9 /etc/services 文件**

众所周知的端口号是由 IANA (互联网号码分配局) 集中注册的，其中每个端口号都有一个对应的服务名（例如，端口 80 对应服务名 `http`）。由于服务号是集中管理并且相对稳定，因此没有必要采用像 DNS 那样复杂的分布式系统来管理它们。

相反，端口号和服务名之间的映射关系记录在一个本地文件 `/etc/services` 中。像 `getaddrinfo()` 和 `getnameinfo()` 这样的库函数会使用这个文件中的信息，在服务名和端口号之间进行双向转换。

#### **文件格式**

`/etc/services` 文件中的每一行都定义了一个服务，其格式如下：

```
service-name   port/protocol   [aliases...]   [# comment]
```

  * **`service-name`**: 官方服务名。
  * **`port/protocol`**: 端口号和使用的协议（通常是 `tcp` 或 `udp`）。
  * **`[aliases...]`**: 可选的、以空格分隔的服务别名。
  * **`[# comment]`**: 注释。

**示例**:

```
# /etc/services example entries
http    80/tcp     www      # World Wide Web HTTP
ssh     22/tcp              # SSH Remote Login Protocol
```

#### **TCP 与 UDP 端口分配**

一个给定的端口号（例如 53）可以同时被一个 TCP socket 和一个 UDP socket 使用，它们是两个独立的实体。

  * **IANA 策略**: 现代的 IANA 策略是，为一个服务同时分配 TCP 和 UDP 两个端口，即使该服务实际上只使用其中一种协议。
      * 例如，`http` 和 `ssh` 只使用 TCP，但对应的 UDP 端口 80 和 22 也被预留给了它们。
      * 同样，`ntp` (网络时间协议) 只使用 UDP，但 TCP 端口 123 也被预留给了它。
  * **历史例外**: 在极少数情况下，数值相同的 UDP 和 TCP 端口被分配给了不同的服务。例如，`rsh` 使用 TCP 端口 514，而 `syslog` 守护进程使用 UDP 端口 514。

#### **重要说明**

`/etc/services` 文件仅仅记录着**名字到数字的映射关系**。它**不是**一种预留机制：

  * 在 `/etc/services` 中存在某个端口号的条目，并**不保证**在实际环境中就有特定的服务正在该端口上运行。
  * 它也**不会**为任何服务“预留”该端口。任何有合适权限的程序都可以尝试绑定到该端口上。
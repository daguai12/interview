### **51.2 System V IPC 与 POSIX IPC 比较**

本节对两种 IPC 机制进行常规性比较。

#### **POSIX IPC 的优势**

与 System V IPC 相比，POSIX IPC 拥有下列常规优势：

1.  **接口更简单**:
    * POSIX IPC 的 API 设计得比 System V IPC 的接口更简洁、更易于使用。

2.  **与文件模型更一致**:
    * POSIX IPC 模型使用**名称**（如 `/my_queue`）来标识对象，而不是 System V 的**键 (key)**。
    * 它使用 `open`、`close` 以及 `unlink` 这一套函数，与传统的 UNIX 文件 I/O 模型更加一致，降低了学习成本。

3.  **引用计数**:
    * POSIX IPC 对象是**引用计数**的。这意味着可以安全地 `unlink` 一个对象来删除其名称，而内核会等到所有进程都关闭该对象之后，才真正地销毁对象。这极大地简化了对象的生命周期管理，避免了 System V IPC 中常见的对象泄露或被过早删除的问题。

#### **System V IPC 的优势 (可移植性)**

尽管 POSIX IPC 在设计上更现代化，但 System V IPC 具备一个显著的优势：**更好的可移植性**。

1.  **标准化与支持范围**:
    * System V IPC 在 SUSv3（Single UNIX Specification）中是**必需**组件，几乎所有的 UNIX 实现都支持它。
    * 相反，POSIX IPC 机制在 SUSv3 中是一个**可选**组件。一些 UNIX 实现并不支持全部的 POSIX IPC 机制。这一点在 Linux 的发展历程中也有所体现：POSIX 共享内存从内核 2.4 开始支持；完整的 POSIX 信号量从内核 2.6 开始支持；POSIX 消息队列从内核 2.6.6 才开始支持。

2.  **命名规则的差异**:
    * 尽管 SUSv3 对 POSIX IPC 对象的名称格式进行了规定（如 `/myobject`），但各种实现仍然在细节上采用不同的规则，这给编写可移植的应用程序带来了一些额外的工作。

3.  **管理工具的缺失**:
    * SUSv3 没有规定用于显示和删除 POSIX IPC 对象的标准命令（不像 System V 有 `ipcs` 和 `ipcrm`）。虽然很多实现都通过虚拟文件系统使其能被 `ls` 和 `rm` 管理，但这些文件系统的具体位置和细节也因实现而异。
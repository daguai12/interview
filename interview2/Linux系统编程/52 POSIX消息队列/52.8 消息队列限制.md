好的，这是根据您提供的文本内容，保留原始结构和标题整理的结果。

### **52.8 消息队列限制**

#### **SUSv3 标准限制**

SUSv3 为 POSIX 消息队列定义了两个限制：

  * **`MQ_PRIO_MAX`**:

      * 定义了一条消息的最大优先级。SUSv3 要求这个上限至少是 32（即优先级范围 0-31）。

  * **`MQ_OPEN_MAX`**:

      * 指明一个进程最多能同时打开的消息队列数量。SUSv3 要求这个限制最小为 8。
      * **在 Linux 上的实现**: Linux **没有**定义这个独立的限制。相反，由于 Linux 将消息队列描述符实现成了文件描述符，因此适用于文件描述符的限制（`RLIMIT_NOFILE`）将同时应用于文件描述符和消息队列描述符的总和。

#### **Linux 特有的限制**

除了上述标准限制之外，Linux 还提供了一些可通过 `/proc` 文件系统来查看和修改的专有限制。这些文件位于 `/proc/sys/fs/mqueue/` 目录中。

  * **`msg_max`**:

      * **作用**: 规定了**单个队列**中能容纳的**最大消息数**（即 `mq_open()` 的 `attr.mq_maxmsg` 字段的上限值）。
      * **默认值**: 10。
      * **特权**: 特权进程（`CAP_SYS_RESOURCE`）在调用 `mq_open()` 时可以忽略此限制。

  * **`msgsize_max`**:

      * **作用**: 规定了**单个消息**的**最大尺寸**（字节数）（即 `mq_open()` 的 `attr.mq_msgsize` 字段的上限值）。
      * **默认值**: 8192。
      * **特权**: 特权进程（`CAP_SYS_RESOURCE`）在调用 `mq_open()` 时可以忽略此限制。

  * **`queues_max`**:

      * **作用**: **系统级别**的限制，规定了系统上最多能够创建的消息队列的**总数量**。
      * **默认值**: 256。
      * **特权**: 一旦达到这个限制，只有特权进程（`CAP_SYS_RESOURCE`）才能够创建新队列。

**查看示例**:

```bash
$ cat /proc/sys/fs/mqueue/msg_max
10
$ cat /proc/sys/fs/mqueue/msgsize_max
8192
$ cat /proc/sys/fs/mqueue/queues_max
256
```

  * **`RLIMIT_MSGQUEUE`**:
      * 这是一个可以通过 `setrlimit()` 设置的**每用户**资源限制。
      * **作用**: 它规定了属于调用进程的**真实用户 ID** 的所有消息队列所能消耗的总内存空间上限（字节）。
### **52.9 POSIX 和 System V 消息队列比较**

本节对 POSIX 消息队列和 System V 消息队列进行总结和比较。

#### **POSIX 消息队列的优势**

首先，POSIX IPC 接口相比于 System V IPC 接口，普遍存在一些优势：
* 接口更简单，并且与传统的 UNIX 文件 I/O 模型更加一致（例如，使用描述符而不是标识符）。
* POSIX IPC 对象是**引用计数**的，这极大地简化了确定何时可以安全删除一个对象的任务。

除此之外，POSIX 消息队列相比于 System V 消息队列，还具备以下两个独特的优势：

1.  **异步消息通知 (`mq_notify`)**:
    * 允许一个进程注册，以便在一个之前为空的队列接收到新消息时，能通过**信号**或**创建新线程**的方式被异步通知。

2.  **可与 I/O 多路复用集成 (Linux 特有)**:
    * 在 Linux 上，POSIX 消息队列描述符实际上是一个文件描述符，因此可以被 `select()`, `poll()` 以及 `epoll` 等 I/O 多路复用系统调用来监控。这使得在同一个事件循环中处理消息队列和其他 I/O（如网络套接字）变得非常简单。

#### **POSIX 消息队列的劣势**

与 System V 消息队列相比，POSIX 消息队列也存在一些劣势：

1.  **可移植性稍差**:
    * POSIX 消息队列被添加到 Linux 中的时间相对较晚（需要内核 2.6.6 及以上版本），因此在一些较老的 Linux 系统或某些其他的 UNIX 实现上可能不受支持。

2.  **消息选择灵活性较低**:
    * **System V 消息队列**: 允许接收进程根据消息的**类型 (`mtype`)** 进行灵活地选择性接收（例如，只接收特定类型的消息，或接收类型值小于某个值的第一条消息）。
    * **POSIX 消息队列**: 只支持严格的**优先级**排队。接收时**总是**获取队列中优先级最高、存在时间最长的消息，无法根据消息内容进行选择。
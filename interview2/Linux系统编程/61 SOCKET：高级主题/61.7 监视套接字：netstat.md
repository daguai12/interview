好的，这是根据您提供的文本内容，保留原始结构和标题整理的结果。

### **61.7 监视套接字：netstat**

`netstat` 程序可以显示系统中 Internet 和 UNIX 域套接字的状态。在编写套接字应用程序时，`netstat` 是一个非常有用的调试工具。

默认情况下，不带任何选项执行 `netstat` 会显示出已连接的套接字信息。我们可以通过一些命令行选项来改变所显示的信息。

#### **常用选项**

**表 61-1：`netstat` 命令的选项**


| 选项 | 描述 |
| :--- | :--- |
| `-a` | 显示**所有**套接字的信息，包括**监听中 (listening)** 的套接字 |
| `-e` | 显示扩展信息（例如，套接字属主的用户 ID） |
| `-c` | **连续**重新显示套接字信息（每秒刷新一次） |
| `-l` | **只**显示**监听中**的套接字信息 |
| `-n` | 以**数字**形式显示 IP 地址、端口号和用户名称（不进行名字解析） |
| `-p` | 显示拥有该套接字的**进程 ID (PID)** 和程序名称 |
| `--inet` | 只显示 Internet 域套接字的信息 |
| `--tcp` | 只显示 TCP (流) 套接字的信息 |
| `--udp` | 只显示 UDP (数据报) 套接字的信息 |
| `--unix` | 只显示 UNIX 域套接字的信息 |

-----

#### **输出示例与解读**

下面是一个使用 `netstat` 列出当前系统上所有 Internet 域套接字信息的示例输出：

```bash
$ netstat --inet -a
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 *:ssh                   *:* LISTEN
tcp        0      0 localhost:smtp          *:* LISTEN
tcp        0      0 localhost:33594         localhost:smtp          ESTABLISHED
tcp        0      0 localhost:smtp          localhost:33594         ESTABLISHED
udp        0      0 *:bootpc                *:*
...
```

对于每个 Internet 域套接字，输出列的含义如下：

  * **`Proto`**: 表示套接字所使用的协议，例如 `tcp` 或 `udp`。
  * **`Recv-Q`**: 表示套接字**接收缓冲区**中，还未被本地应用程序读取的字节数。
  * **`Send-Q`**: 表示套接字**发送缓冲区**中，排队等待发送到对端的字节数。
  * **`Local Address`**: 表示套接字本地绑定到的地址，以 `主机IP:端口号` 的形式表示。地址中主机部分的星号 (`*`) 表示这是一个**通配 IP 地址**（即监听所有网络接口）。
  * **`Foreign Address`**: 这是对端套接字所绑定的地址。字符串 `*:*` 表示没有对端地址（例如，一个监听中的 socket）。
  * **`State`**: 表示当前套接字所处的状态。对于 TCP 套接字来说，这就是 `LISTEN`, `ESTABLISHED`, `TIME_WAIT` 等状态。

-----

#### **Linux 底层实现**

在 Linux 上，程序可以通过读取 `/proc/net` 目录中的多个专有文件，来获取与 `netstat` 输出类似的信息。这些文件的名称很直观，例如 `tcp`, `udp`, `tcp6`, `udp6` 以及 `unix`。